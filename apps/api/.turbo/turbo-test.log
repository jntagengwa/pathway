
> @pathway/api@0.1.0 test /Users/JeanFidele/Projects/pathway/apps/api
> jest -c jest.projects.config.ts

‚óè Validation Warning:

  Unknown option "testTimeout" with value 30000 was found.
  This is probably a typing mistake. Fixing it will remove this message.

  Configuration Documentation:
  https://jestjs.io/docs/configuration

PASS e2e src/users/tests/users.e2e-spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.2] injecting env (15) from ../../.env.test -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [dotenv@17.2.2] injecting env (0) from ../../.env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [test.setup.e2e] Base URL: user=pathway_test_user host=localhost:5433 db=pathway_test_e2e schema=e2e_w1

      at logDbUrl (test.setup.e2e.ts:40:13)

    console.log
      [test.setup.e2e] Worker URL: user=pathway_test_user host=localhost:5433 db=pathway_test_e2e schema=e2e_w1

      at logDbUrl (test.setup.e2e.ts:40:13)

    console.log
      [test.setup.e2e] Skipping prisma migrate reset; assuming schema is pre-migrated. Set E2E_ALLOW_RESET=true to force a reset (requires privileged DB user).

      at Object.<anonymous> (test.setup.e2e.ts:96:11)

PASS e2e src/preferences/tests/preferences.e2e.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.2] injecting env (15) from ../../.env.test -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [dotenv@17.2.2] injecting env (0) from ../../.env -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [test.setup.e2e] Base URL: user=pathway_test_user host=localhost:5433 db=pathway_test_e2e schema=e2e_w1

      at logDbUrl (test.setup.e2e.ts:40:13)

    console.log
      [test.setup.e2e] Worker URL: user=pathway_test_user host=localhost:5433 db=pathway_test_e2e schema=e2e_w1

      at logDbUrl (test.setup.e2e.ts:40:13)

    console.log
      [test.setup.e2e] Skipping prisma migrate reset; assuming schema is pre-migrated. Set E2E_ALLOW_RESET=true to force a reset (requires privileged DB user).

      at Object.<anonymous> (test.setup.e2e.ts:96:11)

PASS e2e src/groups/tests/groups.e2e-spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.2] injecting env (15) from ../../.env.test -- tip: üì° version env with Radar: https://dotenvx.com/radar

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [dotenv@17.2.2] injecting env (0) from ../../.env -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [test.setup.e2e] Base URL: user=pathway_test_user host=localhost:5433 db=pathway_test_e2e schema=e2e_w1

      at logDbUrl (test.setup.e2e.ts:40:13)

    console.log
      [test.setup.e2e] Worker URL: user=pathway_test_user host=localhost:5433 db=pathway_test_e2e schema=e2e_w1

      at logDbUrl (test.setup.e2e.ts:40:13)

    console.log
      [test.setup.e2e] Skipping prisma migrate reset; assuming schema is pre-migrated. Set E2E_ALLOW_RESET=true to force a reset (requires privileged DB user).

      at Object.<anonymous> (test.setup.e2e.ts:96:11)

PASS e2e src/lessons/tests/lessons.e2e.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.2] injecting env (15) from ../../.env.test -- tip: üîê encrypt with Dotenvx: https://dotenvx.com

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [dotenv@17.2.2] injecting env (0) from ../../.env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [test.setup.e2e] Base URL: user=pathway_test_user host=localhost:5433 db=pathway_test_e2e schema=e2e_w1

      at logDbUrl (test.setup.e2e.ts:40:13)

    console.log
      [test.setup.e2e] Worker URL: user=pathway_test_user host=localhost:5433 db=pathway_test_e2e schema=e2e_w1

      at logDbUrl (test.setup.e2e.ts:40:13)

    console.log
      [test.setup.e2e] Skipping prisma migrate reset; assuming schema is pre-migrated. Set E2E_ALLOW_RESET=true to force a reset (requires privileged DB user).

      at Object.<anonymous> (test.setup.e2e.ts:96:11)

PASS e2e src/notes/tests/notes.e2e.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.2] injecting env (15) from ../../.env.test -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [dotenv@17.2.2] injecting env (0) from ../../.env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [test.setup.e2e] Base URL: user=pathway_test_user host=localhost:5433 db=pathway_test_e2e schema=e2e_w1

      at logDbUrl (test.setup.e2e.ts:40:13)

    console.log
      [test.setup.e2e] Worker URL: user=pathway_test_user host=localhost:5433 db=pathway_test_e2e schema=e2e_w1

      at logDbUrl (test.setup.e2e.ts:40:13)

    console.log
      [test.setup.e2e] Skipping prisma migrate reset; assuming schema is pre-migrated. Set E2E_ALLOW_RESET=true to force a reset (requires privileged DB user).

      at Object.<anonymous> (test.setup.e2e.ts:96:11)

PASS e2e src/sessions/tests/sessions.e2e.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.2] injecting env (15) from ../../.env.test -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [dotenv@17.2.2] injecting env (0) from ../../.env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [test.setup.e2e] Base URL: user=pathway_test_user host=localhost:5433 db=pathway_test_e2e schema=e2e_w1

      at logDbUrl (test.setup.e2e.ts:40:13)

    console.log
      [test.setup.e2e] Worker URL: user=pathway_test_user host=localhost:5433 db=pathway_test_e2e schema=e2e_w1

      at logDbUrl (test.setup.e2e.ts:40:13)

    console.log
      [test.setup.e2e] Skipping prisma migrate reset; assuming schema is pre-migrated. Set E2E_ALLOW_RESET=true to force a reset (requires privileged DB user).

      at Object.<anonymous> (test.setup.e2e.ts:96:11)

PASS e2e src/announcements/tests/announcements.e2e.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.2] injecting env (15) from ../../.env.test -- tip: üì° auto-backup env with Radar: https://dotenvx.com/radar

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [dotenv@17.2.2] injecting env (0) from ../../.env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [test.setup.e2e] Base URL: user=pathway_test_user host=localhost:5433 db=pathway_test_e2e schema=e2e_w1

      at logDbUrl (test.setup.e2e.ts:40:13)

    console.log
      [test.setup.e2e] Worker URL: user=pathway_test_user host=localhost:5433 db=pathway_test_e2e schema=e2e_w1

      at logDbUrl (test.setup.e2e.ts:40:13)

    console.log
      [test.setup.e2e] Skipping prisma migrate reset; assuming schema is pre-migrated. Set E2E_ALLOW_RESET=true to force a reset (requires privileged DB user).

      at Object.<anonymous> (test.setup.e2e.ts:96:11)

PASS e2e src/attendance/tests/attendance.e2e.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.2] injecting env (15) from ../../.env.test -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [dotenv@17.2.2] injecting env (0) from ../../.env -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [test.setup.e2e] Base URL: user=pathway_test_user host=localhost:5433 db=pathway_test_e2e schema=e2e_w1

      at logDbUrl (test.setup.e2e.ts:40:13)

    console.log
      [test.setup.e2e] Worker URL: user=pathway_test_user host=localhost:5433 db=pathway_test_e2e schema=e2e_w1

      at logDbUrl (test.setup.e2e.ts:40:13)

    console.log
      [test.setup.e2e] Skipping prisma migrate reset; assuming schema is pre-migrated. Set E2E_ALLOW_RESET=true to force a reset (requires privileged DB user).

      at Object.<anonymous> (test.setup.e2e.ts:96:11)

PASS e2e src/assignments/tests/assignments.e2e.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.2] injecting env (15) from ../../.env.test -- tip: üì° version env with Radar: https://dotenvx.com/radar

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [dotenv@17.2.2] injecting env (0) from ../../.env -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [test.setup.e2e] Base URL: user=pathway_test_user host=localhost:5433 db=pathway_test_e2e schema=e2e_w1

      at logDbUrl (test.setup.e2e.ts:40:13)

    console.log
      [test.setup.e2e] Worker URL: user=pathway_test_user host=localhost:5433 db=pathway_test_e2e schema=e2e_w1

      at logDbUrl (test.setup.e2e.ts:40:13)

    console.log
      [test.setup.e2e] Skipping prisma migrate reset; assuming schema is pre-migrated. Set E2E_ALLOW_RESET=true to force a reset (requires privileged DB user).

      at Object.<anonymous> (test.setup.e2e.ts:96:11)

PASS e2e src/concerns/tests/concerns.e2e.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.2] injecting env (15) from ../../.env.test -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [dotenv@17.2.2] injecting env (0) from ../../.env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [test.setup.e2e] Base URL: user=pathway_test_user host=localhost:5433 db=pathway_test_e2e schema=e2e_w1

      at logDbUrl (test.setup.e2e.ts:40:13)

    console.log
      [test.setup.e2e] Worker URL: user=pathway_test_user host=localhost:5433 db=pathway_test_e2e schema=e2e_w1

      at logDbUrl (test.setup.e2e.ts:40:13)

    console.log
      [test.setup.e2e] Skipping prisma migrate reset; assuming schema is pre-migrated. Set E2E_ALLOW_RESET=true to force a reset (requires privileged DB user).

      at Object.<anonymous> (test.setup.e2e.ts:96:11)

PASS e2e src/billing/tests/billing.e2e.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.2] injecting env (15) from ../../.env.test -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [dotenv@17.2.2] injecting env (0) from ../../.env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [test.setup.e2e] Base URL: user=pathway_test_user host=localhost:5433 db=pathway_test_e2e schema=e2e_w1

      at logDbUrl (test.setup.e2e.ts:40:13)

    console.log
      [test.setup.e2e] Worker URL: user=pathway_test_user host=localhost:5433 db=pathway_test_e2e schema=e2e_w1

      at logDbUrl (test.setup.e2e.ts:40:13)

    console.log
      [test.setup.e2e] Skipping prisma migrate reset; assuming schema is pre-migrated. Set E2E_ALLOW_RESET=true to force a reset (requires privileged DB user).

      at Object.<anonymous> (test.setup.e2e.ts:96:11)

PASS e2e src/tenants/tests/tenants.e2e-spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.2] injecting env (15) from ../../.env.test -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [dotenv@17.2.2] injecting env (0) from ../../.env -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [test.setup.e2e] Base URL: user=pathway_test_user host=localhost:5433 db=pathway_test_e2e schema=e2e_w1

      at logDbUrl (test.setup.e2e.ts:40:13)

    console.log
      [test.setup.e2e] Worker URL: user=pathway_test_user host=localhost:5433 db=pathway_test_e2e schema=e2e_w1

      at logDbUrl (test.setup.e2e.ts:40:13)

    console.log
      [test.setup.e2e] Skipping prisma migrate reset; assuming schema is pre-migrated. Set E2E_ALLOW_RESET=true to force a reset (requires privileged DB user).

      at Object.<anonymous> (test.setup.e2e.ts:96:11)

PASS e2e src/health/tests/health.e2e-spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.2] injecting env (15) from ../../.env.test -- tip: üì° version env with Radar: https://dotenvx.com/radar

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [dotenv@17.2.2] injecting env (0) from ../../.env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [test.setup.e2e] Base URL: user=pathway_test_user host=localhost:5433 db=pathway_test_e2e schema=e2e_w1

      at logDbUrl (test.setup.e2e.ts:40:13)

    console.log
      [test.setup.e2e] Worker URL: user=pathway_test_user host=localhost:5433 db=pathway_test_e2e schema=e2e_w1

      at logDbUrl (test.setup.e2e.ts:40:13)

    console.log
      [test.setup.e2e] Skipping prisma migrate reset; assuming schema is pre-migrated. Set E2E_ALLOW_RESET=true to force a reset (requires privileged DB user).

      at Object.<anonymous> (test.setup.e2e.ts:96:11)

PASS e2e src/orgs/tests/orgs.e2e.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.2] injecting env (15) from ../../.env.test -- tip: üì° version env with Radar: https://dotenvx.com/radar

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [dotenv@17.2.2] injecting env (0) from ../../.env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [test.setup.e2e] Base URL: user=pathway_test_user host=localhost:5433 db=pathway_test_e2e schema=e2e_w1

      at logDbUrl (test.setup.e2e.ts:40:13)

    console.log
      [test.setup.e2e] Worker URL: user=pathway_test_user host=localhost:5433 db=pathway_test_e2e schema=e2e_w1

      at logDbUrl (test.setup.e2e.ts:40:13)

    console.log
      [test.setup.e2e] Skipping prisma migrate reset; assuming schema is pre-migrated. Set E2E_ALLOW_RESET=true to force a reset (requires privileged DB user).

      at Object.<anonymous> (test.setup.e2e.ts:96:11)

    console.log
      [OrgsController] Incoming params: { slug: 'e2e-org' }

      at OrgsController.getBySlug (src/orgs/orgs.controller.ts:75:13)

    console.log
      [OrgsController] Incoming params: { slug: 'unknown-1765508547217' }

      at OrgsController.getBySlug (src/orgs/orgs.controller.ts:75:13)

PASS e2e src/swaps/tests/swaps.e2e.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.2] injecting env (15) from ../../.env.test -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [dotenv@17.2.2] injecting env (0) from ../../.env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [test.setup.e2e] Base URL: user=pathway_test_user host=localhost:5433 db=pathway_test_e2e schema=e2e_w1

      at logDbUrl (test.setup.e2e.ts:40:13)

    console.log
      [test.setup.e2e] Worker URL: user=pathway_test_user host=localhost:5433 db=pathway_test_e2e schema=e2e_w1

      at logDbUrl (test.setup.e2e.ts:40:13)

    console.log
      [test.setup.e2e] Skipping prisma migrate reset; assuming schema is pre-migrated. Set E2E_ALLOW_RESET=true to force a reset (requires privileged DB user).

      at Object.<anonymous> (test.setup.e2e.ts:96:11)

PASS e2e src/tests/rls/pathway-rls.e2e.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.2] injecting env (15) from ../../.env.test -- tip: üì° version env with Radar: https://dotenvx.com/radar

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [dotenv@17.2.2] injecting env (0) from ../../.env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [test.setup.e2e] Base URL: user=pathway_test_user host=localhost:5433 db=pathway_test_e2e schema=e2e_w1

      at logDbUrl (test.setup.e2e.ts:40:13)

    console.log
      [test.setup.e2e] Worker URL: user=pathway_test_user host=localhost:5433 db=pathway_test_e2e schema=e2e_w1

      at logDbUrl (test.setup.e2e.ts:40:13)

    console.log
      [test.setup.e2e] Skipping prisma migrate reset; assuming schema is pre-migrated. Set E2E_ALLOW_RESET=true to force a reset (requires privileged DB user).

      at Object.<anonymous> (test.setup.e2e.ts:96:11)

Environment variables loaded from prisma/.env
Prisma schema loaded from prisma/schema.prisma
Datasource "db": PostgreSQL database "pathway_test_e2e", schema "e2e_w1" at "localhost:5433"
Environment variables loaded from prisma/.env
Prisma schema loaded from prisma/schema.prisma
Datasource "db": PostgreSQL database "pathway_test_e2e", schema "e2e_w1" at "localhost:5433"
Environment variables loaded from prisma/.env
Prisma schema loaded from prisma/schema.prisma
Datasource "db": PostgreSQL database "pathway_test_e2e", schema "e2e_w1" at "localhost:5433"
Environment variables loaded from prisma/.env
Prisma schema loaded from prisma/schema.prisma
Datasource "db": PostgreSQL database "pathway_test_e2e", schema "e2e_w1" at "localhost:5433"




Environment variables loaded from prisma/.env
Prisma schema loaded from prisma/schema.prisma
Datasource "db": PostgreSQL database "pathway_test_e2e", schema "e2e_w1" at "localhost:5433"

Error: P1014

The underlying table for model `_prisma_migrations` does not exist.

Error: ERROR: no schema has been selected to create in
   0: sql_schema_connector::sql_migration_persistence::initialize
           with namespaces=None
             at schema-engine/connectors/sql-schema-connector/src/sql_migration_persistence.rs:14
   1: schema_core::state::ApplyMigrations
             at schema-engine/core/src/state.rs:226

Error: P1014

The underlying table for model `_prisma_migrations` does not exist.

Environment variables loaded from prisma/.env
Prisma schema loaded from prisma/schema.prisma
Datasource "db": PostgreSQL database "pathway_test_e2e", schema "e2e_w1" at "localhost:5433"
Applying migration `20250909134602_init`
Environment variables loaded from prisma/.env
Prisma schema loaded from prisma/schema.prisma
Datasource "db": PostgreSQL database "pathway_test_e2e", schema "e2e_w1" at "localhost:5433"


undefined
/Users/JeanFidele/Projects/pathway/packages/db:
‚ÄâERR_PNPM_RECURSIVE_EXEC_FIRST_FAIL‚Äâ Command failed with exit code 1: prisma migrate reset --force --skip-generate --skip-seed
undefined
/Users/JeanFidele/Projects/pathway/packages/db:
‚ÄâERR_PNPM_RECURSIVE_EXEC_FIRST_FAIL‚Äâ Command failed with exit code 1: prisma migrate reset --force --skip-generate --skip-seed
undefined
/Users/JeanFidele/Projects/pathway/packages/db:
‚ÄâERR_PNPM_RECURSIVE_EXEC_FIRST_FAIL‚Äâ Command failed with exit code 1: prisma migrate reset --force --skip-generate --skip-seed
Applying migration `20250909134602_init`
PASS unit src/notes/tests/notes.service.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.2] injecting env (15) from ../../.env.test -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [dotenv@17.2.2] injecting env (0) from ../../.env -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.warn
      [test.setup.unit] migrate reset failed (continuing): Error: Command failed: pnpm --filter @pathway/db exec prisma migrate reset --force --skip-generate --skip-seed
          at genericNodeError (node:internal/errors:983:15)
          at wrappedFn (node:internal/errors:537:14)
          at checkExecSyncError (node:child_process:890:11)
          at execSync (node:child_process:962:15)
          at run (/Users/JeanFidele/Projects/pathway/apps/api/test.setup.unit.ts:22:15)
          at Object.<anonymous> (/Users/JeanFidele/Projects/pathway/apps/api/test.setup.unit.ts:37:24)
          at Promise.then.completed (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusHook (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:281:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTestsForDescribeBlock (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:95:7)
          at run (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12) {
        status: 1,
        signal: null,
        output: [ null, null, null ],
        pid: 64029,
        stdout: null,
        stderr: null
      }

      61 |     } else {
      62 |       // eslint-disable-next-line no-console
    > 63 |       console.warn(
         |               ^
      64 |         "[test.setup.unit] migrate reset failed (continuing):",
      65 |         firstAttempt,
      66 |       );

      at Object.<anonymous> (test.setup.unit.ts:63:15)

PASS unit src/assignments/tests/assignments.controller.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.2] injecting env (15) from ../../.env.test -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [dotenv@17.2.2] injecting env (0) from ../../.env -- tip: üì° observe env with Radar: https://dotenvx.com/radar

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.warn
      [test.setup.unit] migrate reset failed (continuing): Error: Command failed: pnpm --filter @pathway/db exec prisma migrate reset --force --skip-generate --skip-seed
          at genericNodeError (node:internal/errors:983:15)
          at wrappedFn (node:internal/errors:537:14)
          at checkExecSyncError (node:child_process:890:11)
          at execSync (node:child_process:962:15)
          at run (/Users/JeanFidele/Projects/pathway/apps/api/test.setup.unit.ts:22:15)
          at Object.<anonymous> (/Users/JeanFidele/Projects/pathway/apps/api/test.setup.unit.ts:37:24)
          at Promise.then.completed (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusHook (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:281:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTestsForDescribeBlock (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:95:7)
          at run (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12) {
        status: 1,
        signal: null,
        output: [ null, null, null ],
        pid: 64030,
        stdout: null,
        stderr: null
      }

      61 |     } else {
      62 |       // eslint-disable-next-line no-console
    > 63 |       console.warn(
         |               ^
      64 |         "[test.setup.unit] migrate reset failed (continuing):",
      65 |         firstAttempt,
      66 |       );

      at Object.<anonymous> (test.setup.unit.ts:63:15)

PASS unit src/notes/tests/notes.controller.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.2] injecting env (15) from ../../.env.test -- tip: üì° version env with Radar: https://dotenvx.com/radar

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [dotenv@17.2.2] injecting env (0) from ../../.env -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.warn
      [test.setup.unit] migrate reset failed (continuing): Error: Command failed: pnpm --filter @pathway/db exec prisma migrate reset --force --skip-generate --skip-seed
          at genericNodeError (node:internal/errors:983:15)
          at wrappedFn (node:internal/errors:537:14)
          at checkExecSyncError (node:child_process:890:11)
          at execSync (node:child_process:962:15)
          at run (/Users/JeanFidele/Projects/pathway/apps/api/test.setup.unit.ts:22:15)
          at Object.<anonymous> (/Users/JeanFidele/Projects/pathway/apps/api/test.setup.unit.ts:37:24)
          at Promise.then.completed (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusHook (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:281:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTestsForDescribeBlock (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:95:7)
          at run (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12) {
        status: 1,
        signal: null,
        output: [ null, null, null ],
        pid: 64036,
        stdout: null,
        stderr: null
      }

      61 |     } else {
      62 |       // eslint-disable-next-line no-console
    > 63 |       console.warn(
         |               ^
      64 |         "[test.setup.unit] migrate reset failed (continuing):",
      65 |         firstAttempt,
      66 |       );

      at Object.<anonymous> (test.setup.unit.ts:63:15)

Applying migration `20250913180105_add_child_concerns_allergies_disabilities`
Applying migration `20250913232320_link_swaprequest_to_assignment`
Applying migration `20250917174707_add_announcement_audience`
Applying migration `20250918201718_suites_billing_orgs`
Environment variables loaded from prisma/.env
Prisma schema loaded from prisma/schema.prisma
Environment variables loaded from prisma/.env
Environment variables loaded from prisma/.env
Datasource "db": PostgreSQL database "pathway_test_e2e", schema "e2e_w1" at "localhost:5433"
Prisma schema loaded from prisma/schema.prisma
Prisma schema loaded from prisma/schema.prisma
Datasource "db": PostgreSQL database "pathway_test_e2e", schema "e2e_w1" at "localhost:5433"
Applying migration `20251201121500_safeguarding_audit`
Datasource "db": PostgreSQL database "pathway_test_e2e", schema "e2e_w1" at "localhost:5433"
Environment variables loaded from prisma/.env
Prisma schema loaded from prisma/schema.prisma
Applying migration `20251201144610_pnpm_filter_pathway_api_test_unit_run_tests_by_path_src_common_safeguarding_safeguarding_guard_spec_ts_src_concerns_tests_concerns_service_spec_ts_src_notes_tests_notes_service_spec_ts`
Datasource "db": PostgreSQL database "pathway_test_e2e", schema "e2e_w1" at "localhost:5433"


Applying migration `20251201173000_core_tenant_rls`

Applying migration `20251202110000_enforce_rls_flags`


Database reset successful

The following migration(s) have been applied:

migrations/
  ‚îî‚îÄ 20250909134602_init/
    ‚îî‚îÄ migration.sql
  ‚îî‚îÄ 20250913180105_add_child_concerns_allergies_disabilities/
    ‚îî‚îÄ migration.sql
  ‚îî‚îÄ 20250913232320_link_swaprequest_to_assignment/
    ‚îî‚îÄ migration.sql
  ‚îî‚îÄ 20250917174707_add_announcement_audience/
    ‚îî‚îÄ migration.sql
  ‚îî‚îÄ 20250918201718_suites_billing_orgs/
    ‚îî‚îÄ migration.sql
  ‚îî‚îÄ 20251201121500_safeguarding_audit/
    ‚îî‚îÄ migration.sql
  ‚îî‚îÄ 20251201144610_pnpm_filter_pathway_api_test_unit_run_tests_by_path_src_common_safeguarding_safeguarding_guard_spec_ts_src_concerns_tests_concerns_service_spec_ts_src_notes_tests_notes_service_spec_ts/
    ‚îî‚îÄ migration.sql
  ‚îî‚îÄ 20251201173000_core_tenant_rls/
    ‚îî‚îÄ migration.sql
  ‚îî‚îÄ 20251202110000_enforce_rls_flags/
    ‚îî‚îÄ migration.sql

Error: Invariant violation: migration persistence is not initialized.
   0: schema_core::state::ApplyMigrations
             at schema-engine/core/src/state.rs:226

Error: ERROR: no schema has been selected to create in
   0: sql_schema_connector::sql_migration_persistence::initialize
           with namespaces=None
             at schema-engine/connectors/sql-schema-connector/src/sql_migration_persistence.rs:14
   1: schema_core::state::ApplyMigrations
             at schema-engine/core/src/state.rs:226

PASS unit src/preferences/tests/preference.controller.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.2] injecting env (15) from ../../.env.test -- tip: üì° version env with Radar: https://dotenvx.com/radar

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [dotenv@17.2.2] injecting env (0) from ../../.env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

Error: P1014

The underlying table for model `_prisma_migrations` does not exist.

Error: P3005

The database schema is not empty. Read more about how to baseline an existing production database: https://pris.ly/d/migrate-baseline

Error: P3005

The database schema is not empty. Read more about how to baseline an existing production database: https://pris.ly/d/migrate-baseline

undefined
/Users/JeanFidele/Projects/pathway/packages/db:
‚ÄâERR_PNPM_RECURSIVE_EXEC_FIRST_FAIL‚Äâ Command failed with exit code 1: prisma migrate reset --force --skip-generate --skip-seed
undefined
/Users/JeanFidele/Projects/pathway/packages/db:
‚ÄâERR_PNPM_RECURSIVE_EXEC_FIRST_FAIL‚Äâ Command failed with exit code 1: prisma migrate reset --force --skip-generate --skip-seed
Applying migration `20250909134602_init`
undefined
/Users/JeanFidele/Projects/pathway/packages/db:
‚ÄâERR_PNPM_RECURSIVE_EXEC_FIRST_FAIL‚Äâ Command failed with exit code 1: prisma migrate reset --force --skip-generate --skip-seed
Error: P3005

The database schema is not empty. Read more about how to baseline an existing production database: https://pris.ly/d/migrate-baseline

PASS unit src/users/tests/users.service.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.2] injecting env (15) from ../../.env.test -- tip: üì° version env with Radar: https://dotenvx.com/radar

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [dotenv@17.2.2] injecting env (0) from ../../.env -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.warn
      [test.setup.unit] migrate reset failed (continuing): Error: Command failed: pnpm --filter @pathway/db exec prisma migrate reset --force --skip-generate --skip-seed
          at genericNodeError (node:internal/errors:983:15)
          at wrappedFn (node:internal/errors:537:14)
          at checkExecSyncError (node:child_process:890:11)
          at execSync (node:child_process:962:15)
          at run (/Users/JeanFidele/Projects/pathway/apps/api/test.setup.unit.ts:22:15)
          at Object.<anonymous> (/Users/JeanFidele/Projects/pathway/apps/api/test.setup.unit.ts:37:24)
          at Promise.then.completed (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusHook (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:281:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTestsForDescribeBlock (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:95:7)
          at run (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12) {
        status: 1,
        signal: null,
        output: [ null, null, null ],
        pid: 64038,
        stdout: null,
        stderr: null
      }

      61 |     } else {
      62 |       // eslint-disable-next-line no-console
    > 63 |       console.warn(
         |               ^
      64 |         "[test.setup.unit] migrate reset failed (continuing):",
      65 |         firstAttempt,
      66 |       );

      at Object.<anonymous> (test.setup.unit.ts:63:15)

PASS unit src/attendance/tests/attendance.service.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.2] injecting env (15) from ../../.env.test -- tip: üì° auto-backup env with Radar: https://dotenvx.com/radar

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [dotenv@17.2.2] injecting env (0) from ../../.env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.warn
      [test.setup.unit] migrate reset failed (continuing): Error: Command failed: pnpm --filter @pathway/db exec prisma migrate reset --force --skip-generate --skip-seed
          at genericNodeError (node:internal/errors:983:15)
          at wrappedFn (node:internal/errors:537:14)
          at checkExecSyncError (node:child_process:890:11)
          at execSync (node:child_process:962:15)
          at run (/Users/JeanFidele/Projects/pathway/apps/api/test.setup.unit.ts:22:15)
          at Object.<anonymous> (/Users/JeanFidele/Projects/pathway/apps/api/test.setup.unit.ts:37:24)
          at Promise.then.completed (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusHook (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:281:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTestsForDescribeBlock (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:95:7)
          at run (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12) {
        status: 1,
        signal: null,
        output: [ null, null, null ],
        pid: 64028,
        stdout: null,
        stderr: null
      }

      61 |     } else {
      62 |       // eslint-disable-next-line no-console
    > 63 |       console.warn(
         |               ^
      64 |         "[test.setup.unit] migrate reset failed (continuing):",
      65 |         firstAttempt,
      66 |       );

      at Object.<anonymous> (test.setup.unit.ts:63:15)

Error: P3005

The database schema is not empty. Read more about how to baseline an existing production database: https://pris.ly/d/migrate-baseline

PASS unit src/sessions/tests/sessions.service.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.2] injecting env (15) from ../../.env.test -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [dotenv@17.2.2] injecting env (0) from ../../.env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.warn
      [test.setup.unit] migrate reset failed (continuing): Error: Command failed: pnpm --filter @pathway/db exec prisma migrate reset --force --skip-generate --skip-seed
          at genericNodeError (node:internal/errors:983:15)
          at wrappedFn (node:internal/errors:537:14)
          at checkExecSyncError (node:child_process:890:11)
          at execSync (node:child_process:962:15)
          at run (/Users/JeanFidele/Projects/pathway/apps/api/test.setup.unit.ts:22:15)
          at Object.<anonymous> (/Users/JeanFidele/Projects/pathway/apps/api/test.setup.unit.ts:37:24)
          at Promise.then.completed (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusHook (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:281:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTestsForDescribeBlock (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:95:7)
          at run (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12) {
        status: 1,
        signal: null,
        output: [ null, null, null ],
        pid: 64071,
        stdout: null,
        stderr: null
      }

      61 |     } else {
      62 |       // eslint-disable-next-line no-console
    > 63 |       console.warn(
         |               ^
      64 |         "[test.setup.unit] migrate reset failed (continuing):",
      65 |         firstAttempt,
      66 |       );

      at Object.<anonymous> (test.setup.unit.ts:63:15)

PASS unit src/lessons/tests/lessons.service.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.2] injecting env (15) from ../../.env.test -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [dotenv@17.2.2] injecting env (0) from ../../.env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.warn
      [test.setup.unit] migrate reset failed (continuing): Error: Command failed: pnpm --filter @pathway/db exec prisma migrate reset --force --skip-generate --skip-seed
          at genericNodeError (node:internal/errors:983:15)
          at wrappedFn (node:internal/errors:537:14)
          at checkExecSyncError (node:child_process:890:11)
          at execSync (node:child_process:962:15)
          at run (/Users/JeanFidele/Projects/pathway/apps/api/test.setup.unit.ts:22:15)
          at Object.<anonymous> (/Users/JeanFidele/Projects/pathway/apps/api/test.setup.unit.ts:37:24)
          at Promise.then.completed (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusHook (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:281:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTestsForDescribeBlock (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:95:7)
          at run (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12) {
        status: 1,
        signal: null,
        output: [ null, null, null ],
        pid: 64037,
        stdout: null,
        stderr: null
      }

      61 |     } else {
      62 |       // eslint-disable-next-line no-console
    > 63 |       console.warn(
         |               ^
      64 |         "[test.setup.unit] migrate reset failed (continuing):",
      65 |         firstAttempt,
      66 |       );

      at Object.<anonymous> (test.setup.unit.ts:63:15)

PASS unit src/preferences/tests/preferences.service.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.2] injecting env (15) from ../../.env.test -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [dotenv@17.2.2] injecting env (0) from ../../.env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.warn
      [test.setup.unit] migrate reset failed (continuing): Error: Command failed: pnpm --filter @pathway/db exec prisma migrate reset --force --skip-generate --skip-seed
          at genericNodeError (node:internal/errors:983:15)
          at wrappedFn (node:internal/errors:537:14)
          at checkExecSyncError (node:child_process:890:11)
          at execSync (node:child_process:962:15)
          at run (/Users/JeanFidele/Projects/pathway/apps/api/test.setup.unit.ts:22:15)
          at Object.<anonymous> (/Users/JeanFidele/Projects/pathway/apps/api/test.setup.unit.ts:37:24)
          at Promise.then.completed (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusHook (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:281:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTestsForDescribeBlock (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:95:7)
          at run (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12) {
        status: 1,
        signal: null,
        output: [ null, null, null ],
        pid: 64066,
        stdout: null,
        stderr: null
      }

      61 |     } else {
      62 |       // eslint-disable-next-line no-console
    > 63 |       console.warn(
         |               ^
      64 |         "[test.setup.unit] migrate reset failed (continuing):",
      65 |         firstAttempt,
      66 |       );

      at Object.<anonymous> (test.setup.unit.ts:63:15)

undefined
/Users/JeanFidele/Projects/pathway/packages/db:
‚ÄâERR_PNPM_RECURSIVE_EXEC_FIRST_FAIL‚Äâ Command failed with exit code 1: prisma migrate reset --force --skip-generate --skip-seed
undefined
/Users/JeanFidele/Projects/pathway/packages/db:
‚ÄâERR_PNPM_RECURSIVE_EXEC_FIRST_FAIL‚Äâ Command failed with exit code 1: prisma migrate reset --force --skip-generate --skip-seed
undefined
/Users/JeanFidele/Projects/pathway/packages/db:
‚ÄâERR_PNPM_RECURSIVE_EXEC_FIRST_FAIL‚Äâ Command failed with exit code 1: prisma migrate reset --force --skip-generate --skip-seed
undefined
/Users/JeanFidele/Projects/pathway/packages/db:
‚ÄâERR_PNPM_RECURSIVE_EXEC_FIRST_FAIL‚Äâ Command failed with exit code 1: prisma migrate reset --force --skip-generate --skip-seed
PASS unit src/concerns/tests/concerns.controller.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.2] injecting env (15) from ../../.env.test -- tip: üì° auto-backup env with Radar: https://dotenvx.com/radar

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [dotenv@17.2.2] injecting env (0) from ../../.env -- tip: üì° auto-backup env with Radar: https://dotenvx.com/radar

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.warn
      [test.setup.unit] migrate reset failed (continuing): Error: Command failed: pnpm --filter @pathway/db exec prisma migrate reset --force --skip-generate --skip-seed
          at genericNodeError (node:internal/errors:983:15)
          at wrappedFn (node:internal/errors:537:14)
          at checkExecSyncError (node:child_process:890:11)
          at execSync (node:child_process:962:15)
          at run (/Users/JeanFidele/Projects/pathway/apps/api/test.setup.unit.ts:22:15)
          at Object.<anonymous> (/Users/JeanFidele/Projects/pathway/apps/api/test.setup.unit.ts:37:24)
          at Promise.then.completed (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusHook (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:281:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTestsForDescribeBlock (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:95:7)
          at run (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12) {
        status: 1,
        signal: null,
        output: [ null, null, null ],
        pid: 64073,
        stdout: null,
        stderr: null
      }

      61 |     } else {
      62 |       // eslint-disable-next-line no-console
    > 63 |       console.warn(
         |               ^
      64 |         "[test.setup.unit] migrate reset failed (continuing):",
      65 |         firstAttempt,
      66 |       );

      at Object.<anonymous> (test.setup.unit.ts:63:15)

PASS unit src/lessons/tests/lessons.controller.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.2] injecting env (15) from ../../.env.test -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [dotenv@17.2.2] injecting env (0) from ../../.env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.warn
      [test.setup.unit] migrate reset failed (continuing): Error: Command failed: pnpm --filter @pathway/db exec prisma migrate reset --force --skip-generate --skip-seed
          at genericNodeError (node:internal/errors:983:15)
          at wrappedFn (node:internal/errors:537:14)
          at checkExecSyncError (node:child_process:890:11)
          at execSync (node:child_process:962:15)
          at run (/Users/JeanFidele/Projects/pathway/apps/api/test.setup.unit.ts:22:15)
          at Object.<anonymous> (/Users/JeanFidele/Projects/pathway/apps/api/test.setup.unit.ts:37:24)
          at Promise.then.completed (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusHook (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:281:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTestsForDescribeBlock (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:95:7)
          at run (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12) {
        status: 1,
        signal: null,
        output: [ null, null, null ],
        pid: 64062,
        stdout: null,
        stderr: null
      }

      61 |     } else {
      62 |       // eslint-disable-next-line no-console
    > 63 |       console.warn(
         |               ^
      64 |         "[test.setup.unit] migrate reset failed (continuing):",
      65 |         firstAttempt,
      66 |       );

      at Object.<anonymous> (test.setup.unit.ts:63:15)

FAIL e2e src/children/tests/children.e2e.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.2] injecting env (15) from ../../.env.test -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [dotenv@17.2.2] injecting env (0) from ../../.env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [test.setup.e2e] Base URL: user=pathway_test_user host=localhost:5433 db=pathway_test_e2e schema=e2e_w1

      at logDbUrl (test.setup.e2e.ts:40:13)

    console.log
      [test.setup.e2e] Worker URL: user=pathway_test_user host=localhost:5433 db=pathway_test_e2e schema=e2e_w1

      at logDbUrl (test.setup.e2e.ts:40:13)

    console.log
      [test.setup.e2e] Skipping prisma migrate reset; assuming schema is pre-migrated. Set E2E_ALLOW_RESET=true to force a reset (requires privileged DB user).

      at Object.<anonymous> (test.setup.e2e.ts:96:11)

    console.error
      [test.setup.e2e] Smoke check failed: cannot read _prisma_migrations. Ensure schema is migrated and test role has USAGE/SELECT grants. Tests will likely fail. PrismaClientKnownRequestError: 
      Invalid `prisma.$queryRaw()` invocation:
      
      
      Raw query failed. Code: `42P01`. Message: `relation "_prisma_migrations" does not exist`
          at $n.handleRequestError (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:7315)
          at $n.handleAndLogRequestError (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:6623)
          at $n.request (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:6307)
          at l (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:130:9633)
          at Object.<anonymous> (/Users/JeanFidele/Projects/pathway/apps/api/test.setup.e2e.ts:114:5) {
        code: 'P2010',
        clientVersion: '5.22.0',
        meta: {
          code: '42P01',
          message: 'relation "_prisma_migrations" does not exist'
        }
      }

      114 |     await prisma.$queryRaw`SELECT 1 FROM "_prisma_migrations" LIMIT 1`;
      115 |   } catch (error) {
    > 116 |     console.error(
          |             ^
      117 |       "[test.setup.e2e] Smoke check failed: cannot read _prisma_migrations. Ensure schema is migrated and test role has USAGE/SELECT grants. Tests will likely fail.",
      118 |       error,
      119 |     );

      at Object.<anonymous> (test.setup.e2e.ts:116:13)

  ‚óè Children (e2e) ‚Ä∫ GET /children should return array

    PrismaClientKnownRequestError: 
    Invalid `prisma.$queryRaw()` invocation:


    Raw query failed. Code: `42P01`. Message: `relation "_prisma_migrations" does not exist`

      112 |   // Quick smoke check: ensure the test role can read migrations metadata.
      113 |   try {
    > 114 |     await prisma.$queryRaw`SELECT 1 FROM "_prisma_migrations" LIMIT 1`;
          |     ^
      115 |   } catch (error) {
      116 |     console.error(
      117 |       "[test.setup.e2e] Smoke check failed: cannot read _prisma_migrations. Ensure schema is migrated and test role has USAGE/SELECT grants. Tests will likely fail.",

      at $n.handleRequestError (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:7315)
      at $n.handleAndLogRequestError (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (test.setup.e2e.ts:114:5)

  ‚óè Children (e2e) ‚Ä∫ GET /children should return array

    PrismaClientKnownRequestError: 
    Invalid `tx.group.create()` invocation in
    /Users/JeanFidele/Projects/pathway/apps/api/src/children/tests/children.e2e.spec.ts:35:32

      32 await app.init();
      33 
      34 await withTenantRlsContext(tenantId, orgId, async (tx) => {
    ‚Üí 35   const g = await tx.group.create(
    Foreign key constraint violated: `Group_tenantId_fkey (index)`

      33 |
      34 |     await withTenantRlsContext(tenantId, orgId, async (tx) => {
    > 35 |       const g = await tx.group.create({
         |                 ^
      36 |         data: { name: `Sparks-${nonce}`, minAge: 5, maxAge: 7, tenantId },
      37 |         select: { id: true },
      38 |       });

      at $n.handleRequestError (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:7315)
      at $n.handleAndLogRequestError (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:130:9633)
      at src/children/tests/children.e2e.spec.ts:35:17
      at Proxy._transactionWithCallback (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:130:8000)
      at Object.<anonymous> (src/children/tests/children.e2e.spec.ts:34:5)

  ‚óè Children (e2e) ‚Ä∫ POST /children should create a child (minimal)

    PrismaClientKnownRequestError: 
    Invalid `prisma.$queryRaw()` invocation:


    Raw query failed. Code: `42P01`. Message: `relation "_prisma_migrations" does not exist`

      112 |   // Quick smoke check: ensure the test role can read migrations metadata.
      113 |   try {
    > 114 |     await prisma.$queryRaw`SELECT 1 FROM "_prisma_migrations" LIMIT 1`;
          |     ^
      115 |   } catch (error) {
      116 |     console.error(
      117 |       "[test.setup.e2e] Smoke check failed: cannot read _prisma_migrations. Ensure schema is migrated and test role has USAGE/SELECT grants. Tests will likely fail.",

      at $n.handleRequestError (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:7315)
      at $n.handleAndLogRequestError (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (test.setup.e2e.ts:114:5)

  ‚óè Children (e2e) ‚Ä∫ POST /children should create a child (minimal)

    PrismaClientKnownRequestError: 
    Invalid `tx.group.create()` invocation in
    /Users/JeanFidele/Projects/pathway/apps/api/src/children/tests/children.e2e.spec.ts:35:32

      32 await app.init();
      33 
      34 await withTenantRlsContext(tenantId, orgId, async (tx) => {
    ‚Üí 35   const g = await tx.group.create(
    Foreign key constraint violated: `Group_tenantId_fkey (index)`

      33 |
      34 |     await withTenantRlsContext(tenantId, orgId, async (tx) => {
    > 35 |       const g = await tx.group.create({
         |                 ^
      36 |         data: { name: `Sparks-${nonce}`, minAge: 5, maxAge: 7, tenantId },
      37 |         select: { id: true },
      38 |       });

      at $n.handleRequestError (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:7315)
      at $n.handleAndLogRequestError (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:130:9633)
      at src/children/tests/children.e2e.spec.ts:35:17
      at Proxy._transactionWithCallback (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:130:8000)
      at Object.<anonymous> (src/children/tests/children.e2e.spec.ts:34:5)

  ‚óè Children (e2e) ‚Ä∫ GET /children/:id should return the created child

    PrismaClientKnownRequestError: 
    Invalid `prisma.$queryRaw()` invocation:


    Raw query failed. Code: `42P01`. Message: `relation "_prisma_migrations" does not exist`

      112 |   // Quick smoke check: ensure the test role can read migrations metadata.
      113 |   try {
    > 114 |     await prisma.$queryRaw`SELECT 1 FROM "_prisma_migrations" LIMIT 1`;
          |     ^
      115 |   } catch (error) {
      116 |     console.error(
      117 |       "[test.setup.e2e] Smoke check failed: cannot read _prisma_migrations. Ensure schema is migrated and test role has USAGE/SELECT grants. Tests will likely fail.",

      at $n.handleRequestError (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:7315)
      at $n.handleAndLogRequestError (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (test.setup.e2e.ts:114:5)

  ‚óè Children (e2e) ‚Ä∫ GET /children/:id should return the created child

    PrismaClientKnownRequestError: 
    Invalid `tx.group.create()` invocation in
    /Users/JeanFidele/Projects/pathway/apps/api/src/children/tests/children.e2e.spec.ts:35:32

      32 await app.init();
      33 
      34 await withTenantRlsContext(tenantId, orgId, async (tx) => {
    ‚Üí 35   const g = await tx.group.create(
    Foreign key constraint violated: `Group_tenantId_fkey (index)`

      33 |
      34 |     await withTenantRlsContext(tenantId, orgId, async (tx) => {
    > 35 |       const g = await tx.group.create({
         |                 ^
      36 |         data: { name: `Sparks-${nonce}`, minAge: 5, maxAge: 7, tenantId },
      37 |         select: { id: true },
      38 |       });

      at $n.handleRequestError (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:7315)
      at $n.handleAndLogRequestError (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:130:9633)
      at src/children/tests/children.e2e.spec.ts:35:17
      at Proxy._transactionWithCallback (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:130:8000)
      at Object.<anonymous> (src/children/tests/children.e2e.spec.ts:34:5)

  ‚óè Children (e2e) ‚Ä∫ PATCH /children/:id should update group and guardians

    PrismaClientKnownRequestError: 
    Invalid `prisma.$queryRaw()` invocation:


    Raw query failed. Code: `42P01`. Message: `relation "_prisma_migrations" does not exist`

      112 |   // Quick smoke check: ensure the test role can read migrations metadata.
      113 |   try {
    > 114 |     await prisma.$queryRaw`SELECT 1 FROM "_prisma_migrations" LIMIT 1`;
          |     ^
      115 |   } catch (error) {
      116 |     console.error(
      117 |       "[test.setup.e2e] Smoke check failed: cannot read _prisma_migrations. Ensure schema is migrated and test role has USAGE/SELECT grants. Tests will likely fail.",

      at $n.handleRequestError (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:7315)
      at $n.handleAndLogRequestError (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (test.setup.e2e.ts:114:5)

  ‚óè Children (e2e) ‚Ä∫ PATCH /children/:id should update group and guardians

    PrismaClientKnownRequestError: 
    Invalid `tx.group.create()` invocation in
    /Users/JeanFidele/Projects/pathway/apps/api/src/children/tests/children.e2e.spec.ts:35:32

      32 await app.init();
      33 
      34 await withTenantRlsContext(tenantId, orgId, async (tx) => {
    ‚Üí 35   const g = await tx.group.create(
    Foreign key constraint violated: `Group_tenantId_fkey (index)`

      33 |
      34 |     await withTenantRlsContext(tenantId, orgId, async (tx) => {
    > 35 |       const g = await tx.group.create({
         |                 ^
      36 |         data: { name: `Sparks-${nonce}`, minAge: 5, maxAge: 7, tenantId },
      37 |         select: { id: true },
      38 |       });

      at $n.handleRequestError (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:7315)
      at $n.handleAndLogRequestError (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:130:9633)
      at src/children/tests/children.e2e.spec.ts:35:17
      at Proxy._transactionWithCallback (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:130:8000)
      at Object.<anonymous> (src/children/tests/children.e2e.spec.ts:34:5)

  ‚óè Children (e2e) ‚Ä∫ POST /children invalid body should 400 (missing allergies)

    PrismaClientKnownRequestError: 
    Invalid `prisma.$queryRaw()` invocation:


    Raw query failed. Code: `42P01`. Message: `relation "_prisma_migrations" does not exist`

      112 |   // Quick smoke check: ensure the test role can read migrations metadata.
      113 |   try {
    > 114 |     await prisma.$queryRaw`SELECT 1 FROM "_prisma_migrations" LIMIT 1`;
          |     ^
      115 |   } catch (error) {
      116 |     console.error(
      117 |       "[test.setup.e2e] Smoke check failed: cannot read _prisma_migrations. Ensure schema is migrated and test role has USAGE/SELECT grants. Tests will likely fail.",

      at $n.handleRequestError (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:7315)
      at $n.handleAndLogRequestError (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (test.setup.e2e.ts:114:5)

  ‚óè Children (e2e) ‚Ä∫ POST /children invalid body should 400 (missing allergies)

    PrismaClientKnownRequestError: 
    Invalid `tx.group.create()` invocation in
    /Users/JeanFidele/Projects/pathway/apps/api/src/children/tests/children.e2e.spec.ts:35:32

      32 await app.init();
      33 
      34 await withTenantRlsContext(tenantId, orgId, async (tx) => {
    ‚Üí 35   const g = await tx.group.create(
    Foreign key constraint violated: `Group_tenantId_fkey (index)`

      33 |
      34 |     await withTenantRlsContext(tenantId, orgId, async (tx) => {
    > 35 |       const g = await tx.group.create({
         |                 ^
      36 |         data: { name: `Sparks-${nonce}`, minAge: 5, maxAge: 7, tenantId },
      37 |         select: { id: true },
      38 |       });

      at $n.handleRequestError (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:7315)
      at $n.handleAndLogRequestError (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:130:9633)
      at src/children/tests/children.e2e.spec.ts:35:17
      at Proxy._transactionWithCallback (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:130:8000)
      at Object.<anonymous> (src/children/tests/children.e2e.spec.ts:34:5)

  ‚óè Children (e2e) ‚Ä∫ POST /children group from another tenant should 400

    PrismaClientKnownRequestError: 
    Invalid `prisma.$queryRaw()` invocation:


    Raw query failed. Code: `42P01`. Message: `relation "_prisma_migrations" does not exist`

      112 |   // Quick smoke check: ensure the test role can read migrations metadata.
      113 |   try {
    > 114 |     await prisma.$queryRaw`SELECT 1 FROM "_prisma_migrations" LIMIT 1`;
          |     ^
      115 |   } catch (error) {
      116 |     console.error(
      117 |       "[test.setup.e2e] Smoke check failed: cannot read _prisma_migrations. Ensure schema is migrated and test role has USAGE/SELECT grants. Tests will likely fail.",

      at $n.handleRequestError (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:7315)
      at $n.handleAndLogRequestError (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (test.setup.e2e.ts:114:5)

  ‚óè Children (e2e) ‚Ä∫ POST /children group from another tenant should 400

    PrismaClientKnownRequestError: 
    Invalid `tx.group.create()` invocation in
    /Users/JeanFidele/Projects/pathway/apps/api/src/children/tests/children.e2e.spec.ts:35:32

      32 await app.init();
      33 
      34 await withTenantRlsContext(tenantId, orgId, async (tx) => {
    ‚Üí 35   const g = await tx.group.create(
    Foreign key constraint violated: `Group_tenantId_fkey (index)`

      33 |
      34 |     await withTenantRlsContext(tenantId, orgId, async (tx) => {
    > 35 |       const g = await tx.group.create({
         |                 ^
      36 |         data: { name: `Sparks-${nonce}`, minAge: 5, maxAge: 7, tenantId },
      37 |         select: { id: true },
      38 |       });

      at $n.handleRequestError (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:7315)
      at $n.handleAndLogRequestError (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:130:9633)
      at src/children/tests/children.e2e.spec.ts:35:17
      at Proxy._transactionWithCallback (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:130:8000)
      at Object.<anonymous> (src/children/tests/children.e2e.spec.ts:34:5)

Environment variables loaded from prisma/.env
Prisma schema loaded from prisma/schema.prisma
Datasource "db": PostgreSQL database "pathway_test_e2e", schema "e2e_w1" at "localhost:5433"
Environment variables loaded from prisma/.env
Prisma schema loaded from prisma/schema.prisma
Datasource "db": PostgreSQL database "pathway_test_e2e", schema "e2e_w1" at "localhost:5433"
Environment variables loaded from prisma/.env
Prisma schema loaded from prisma/schema.prisma
Datasource "db": PostgreSQL database "pathway_test_e2e", schema "e2e_w1" at "localhost:5433"



Applying migration `20250909134602_init`
Applying migration `20250913180105_add_child_concerns_allergies_disabilities`
Applying migration `20250913232320_link_swaprequest_to_assignment`
Applying migration `20250917174707_add_announcement_audience`
Applying migration `20250918201718_suites_billing_orgs`
Environment variables loaded from prisma/.env
Prisma schema loaded from prisma/schema.prisma
Datasource "db": PostgreSQL database "pathway_test_e2e", schema "e2e_w1" at "localhost:5433"
Environment variables loaded from prisma/.env
Prisma schema loaded from prisma/schema.prisma
Datasource "db": PostgreSQL database "pathway_test_e2e", schema "e2e_w1" at "localhost:5433"
Environment variables loaded from prisma/.env
Environment variables loaded from prisma/.env
Prisma schema loaded from prisma/schema.prisma
Prisma schema loaded from prisma/schema.prisma
Environment variables loaded from prisma/.env
Prisma schema loaded from prisma/schema.prisma

Datasource "db": PostgreSQL database "pathway_test_e2e", schema "e2e_w1" at "localhost:5433"
Datasource "db": PostgreSQL database "pathway_test_e2e", schema "e2e_w1" at "localhost:5433"
Applying migration `20251201121500_safeguarding_audit`
Datasource "db": PostgreSQL database "pathway_test_e2e", schema "e2e_w1" at "localhost:5433"
Error: P1014

The underlying table for model `_prisma_migrations` does not exist.

Error: ERROR: no schema has been selected to create in
   0: sql_schema_connector::sql_migration_persistence::initialize
           with namespaces=None
             at schema-engine/connectors/sql-schema-connector/src/sql_migration_persistence.rs:14
   1: schema_core::state::ApplyMigrations
             at schema-engine/core/src/state.rs:226

Error: Invariant violation: migration persistence is not initialized.
   0: schema_core::state::ApplyMigrations
             at schema-engine/core/src/state.rs:226


Environment variables loaded from prisma/.env
Prisma schema loaded from prisma/schema.prisma

Datasource "db": PostgreSQL database "pathway_test_e2e", schema "e2e_w1" at "localhost:5433"


Applying migration `20251201144610_pnpm_filter_pathway_api_test_unit_run_tests_by_path_src_common_safeguarding_safeguarding_guard_spec_ts_src_concerns_tests_concerns_service_spec_ts_src_notes_tests_notes_service_spec_ts`
Environment variables loaded from prisma/.env
Prisma schema loaded from prisma/schema.prisma
Datasource "db": PostgreSQL database "pathway_test_e2e", schema "e2e_w1" at "localhost:5433"
Environment variables loaded from prisma/.env
Prisma schema loaded from prisma/schema.prisma
Datasource "db": PostgreSQL database "pathway_test_e2e", schema "e2e_w1" at "localhost:5433"
undefined
/Users/JeanFidele/Projects/pathway/packages/db:
‚ÄâERR_PNPM_RECURSIVE_EXEC_FIRST_FAIL‚Äâ Command failed with exit code 1: prisma migrate reset --force --skip-generate --skip-seed
undefined
/Users/JeanFidele/Projects/pathway/packages/db:
‚ÄâERR_PNPM_RECURSIVE_EXEC_FIRST_FAIL‚Äâ Command failed with exit code 1: prisma migrate reset --force --skip-generate --skip-seed


undefined
/Users/JeanFidele/Projects/pathway/packages/db:
‚ÄâERR_PNPM_RECURSIVE_EXEC_FIRST_FAIL‚Äâ Command failed with exit code 1: prisma migrate reset --force --skip-generate --skip-seed
Applying migration `20250909134602_init`

PASS unit src/children/tests/children.service.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.2] injecting env (15) from ../../.env.test -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [dotenv@17.2.2] injecting env (0) from ../../.env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.warn
      [test.setup.unit] migrate reset failed (continuing): Error: Command failed: pnpm --filter @pathway/db exec prisma migrate reset --force --skip-generate --skip-seed
          at genericNodeError (node:internal/errors:983:15)
          at wrappedFn (node:internal/errors:537:14)
          at checkExecSyncError (node:child_process:890:11)
          at execSync (node:child_process:962:15)
          at run (/Users/JeanFidele/Projects/pathway/apps/api/test.setup.unit.ts:22:15)
          at Object.<anonymous> (/Users/JeanFidele/Projects/pathway/apps/api/test.setup.unit.ts:37:24)
          at Promise.then.completed (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusHook (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:281:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTestsForDescribeBlock (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:95:7)
          at run (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12) {
        status: 1,
        signal: null,
        output: [ null, null, null ],
        pid: 64179,
        stdout: null,
        stderr: null
      }

      61 |     } else {
      62 |       // eslint-disable-next-line no-console
    > 63 |       console.warn(
         |               ^
      64 |         "[test.setup.unit] migrate reset failed (continuing):",
      65 |         firstAttempt,
      66 |       );

      at Object.<anonymous> (test.setup.unit.ts:63:15)

PASS unit src/users/tests/users.controller.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.2] injecting env (15) from ../../.env.test -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [dotenv@17.2.2] injecting env (0) from ../../.env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.warn
      [test.setup.unit] migrate reset failed (continuing): Error: Command failed: pnpm --filter @pathway/db exec prisma migrate reset --force --skip-generate --skip-seed
          at genericNodeError (node:internal/errors:983:15)
          at wrappedFn (node:internal/errors:537:14)
          at checkExecSyncError (node:child_process:890:11)
          at execSync (node:child_process:962:15)
          at run (/Users/JeanFidele/Projects/pathway/apps/api/test.setup.unit.ts:22:15)
          at Object.<anonymous> (/Users/JeanFidele/Projects/pathway/apps/api/test.setup.unit.ts:37:24)
          at Promise.then.completed (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusHook (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:281:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTestsForDescribeBlock (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:95:7)
          at run (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12) {
        status: 1,
        signal: null,
        output: [ null, null, null ],
        pid: 64186,
        stdout: null,
        stderr: null
      }

      61 |     } else {
      62 |       // eslint-disable-next-line no-console
    > 63 |       console.warn(
         |               ^
      64 |         "[test.setup.unit] migrate reset failed (continuing):",
      65 |         firstAttempt,
      66 |       );

      at Object.<anonymous> (test.setup.unit.ts:63:15)

PASS unit src/tenants/tests/tenants.service.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.2] injecting env (15) from ../../.env.test -- tip: üîê encrypt with Dotenvx: https://dotenvx.com

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [dotenv@17.2.2] injecting env (0) from ../../.env -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.warn
      [test.setup.unit] migrate reset failed (continuing): Error: Command failed: pnpm --filter @pathway/db exec prisma migrate reset --force --skip-generate --skip-seed
          at genericNodeError (node:internal/errors:983:15)
          at wrappedFn (node:internal/errors:537:14)
          at checkExecSyncError (node:child_process:890:11)
          at execSync (node:child_process:962:15)
          at run (/Users/JeanFidele/Projects/pathway/apps/api/test.setup.unit.ts:22:15)
          at Object.<anonymous> (/Users/JeanFidele/Projects/pathway/apps/api/test.setup.unit.ts:37:24)
          at Promise.then.completed (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusHook (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:281:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTestsForDescribeBlock (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:95:7)
          at run (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12) {
        status: 1,
        signal: null,
        output: [ null, null, null ],
        pid: 64180,
        stdout: null,
        stderr: null
      }

      61 |     } else {
      62 |       // eslint-disable-next-line no-console
    > 63 |       console.warn(
         |               ^
      64 |         "[test.setup.unit] migrate reset failed (continuing):",
      65 |         firstAttempt,
      66 |       );

      at Object.<anonymous> (test.setup.unit.ts:63:15)

Applying migration `20250913180105_add_child_concerns_allergies_disabilities`
Applying migration `20250913232320_link_swaprequest_to_assignment`
Applying migration `20250917174707_add_announcement_audience`
Applying migration `20250918201718_suites_billing_orgs`
Error: P1014

The underlying table for model `_prisma_migrations` does not exist.

Error: ERROR: no schema has been selected to create in
   0: sql_schema_connector::sql_migration_persistence::initialize
           with namespaces=None
             at schema-engine/connectors/sql-schema-connector/src/sql_migration_persistence.rs:14
   1: schema_core::state::ApplyMigrations
             at schema-engine/core/src/state.rs:226

Error: P1014

The underlying table for model `_prisma_migrations` does not exist.

PASS unit src/children/tests/children.controller.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.2] injecting env (15) from ../../.env.test -- tip: üì° auto-backup env with Radar: https://dotenvx.com/radar

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [dotenv@17.2.2] injecting env (0) from ../../.env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.warn
      [test.setup.unit] migrate reset failed (continuing): Error: Command failed: pnpm --filter @pathway/db exec prisma migrate reset --force --skip-generate --skip-seed
          at genericNodeError (node:internal/errors:983:15)
          at wrappedFn (node:internal/errors:537:14)
          at checkExecSyncError (node:child_process:890:11)
          at execSync (node:child_process:962:15)
          at run (/Users/JeanFidele/Projects/pathway/apps/api/test.setup.unit.ts:22:15)
          at Object.<anonymous> (/Users/JeanFidele/Projects/pathway/apps/api/test.setup.unit.ts:37:24)
          at Promise.then.completed (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusHook (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:281:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTestsForDescribeBlock (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:95:7)
          at run (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12) {
        status: 1,
        signal: null,
        output: [ null, null, null ],
        pid: 64301,
        stdout: null,
        stderr: null
      }

      61 |     } else {
      62 |       // eslint-disable-next-line no-console
    > 63 |       console.warn(
         |               ^
      64 |         "[test.setup.unit] migrate reset failed (continuing):",
      65 |         firstAttempt,
      66 |       );

      at Object.<anonymous> (test.setup.unit.ts:63:15)

PASS unit src/attendance/tests/attendance.controller.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.2] injecting env (15) from ../../.env.test -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [dotenv@17.2.2] injecting env (0) from ../../.env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.warn
      [test.setup.unit] migrate reset failed (continuing): Error: Command failed: pnpm --filter @pathway/db exec prisma migrate reset --force --skip-generate --skip-seed
          at genericNodeError (node:internal/errors:983:15)
          at wrappedFn (node:internal/errors:537:14)
          at checkExecSyncError (node:child_process:890:11)
          at execSync (node:child_process:962:15)
          at run (/Users/JeanFidele/Projects/pathway/apps/api/test.setup.unit.ts:22:15)
          at Object.<anonymous> (/Users/JeanFidele/Projects/pathway/apps/api/test.setup.unit.ts:37:24)
          at Promise.then.completed (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusHook (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:281:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTestsForDescribeBlock (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:95:7)
          at run (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12) {
        status: 1,
        signal: null,
        output: [ null, null, null ],
        pid: 64299,
        stdout: null,
        stderr: null
      }

      61 |     } else {
      62 |       // eslint-disable-next-line no-console
    > 63 |       console.warn(
         |               ^
      64 |         "[test.setup.unit] migrate reset failed (continuing):",
      65 |         firstAttempt,
      66 |       );

      at Object.<anonymous> (test.setup.unit.ts:63:15)

PASS unit src/tenants/tests/tenants.controller.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.2] injecting env (15) from ../../.env.test -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [dotenv@17.2.2] injecting env (0) from ../../.env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.warn
      [test.setup.unit] migrate reset failed (continuing): Error: Command failed: pnpm --filter @pathway/db exec prisma migrate reset --force --skip-generate --skip-seed
          at genericNodeError (node:internal/errors:983:15)
          at wrappedFn (node:internal/errors:537:14)
          at checkExecSyncError (node:child_process:890:11)
          at execSync (node:child_process:962:15)
          at run (/Users/JeanFidele/Projects/pathway/apps/api/test.setup.unit.ts:22:15)
          at Object.<anonymous> (/Users/JeanFidele/Projects/pathway/apps/api/test.setup.unit.ts:37:24)
          at Promise.then.completed (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusHook (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:281:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTestsForDescribeBlock (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:95:7)
          at run (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12) {
        status: 1,
        signal: null,
        output: [ null, null, null ],
        pid: 64300,
        stdout: null,
        stderr: null
      }

      61 |     } else {
      62 |       // eslint-disable-next-line no-console
    > 63 |       console.warn(
         |               ^
      64 |         "[test.setup.unit] migrate reset failed (continuing):",
      65 |         firstAttempt,
      66 |       );

      at Object.<anonymous> (test.setup.unit.ts:63:15)

undefined
/Users/JeanFidele/Projects/pathway/packages/db:
‚ÄâERR_PNPM_RECURSIVE_EXEC_FIRST_FAIL‚Äâ Command failed with exit code 1: prisma migrate reset --force --skip-generate --skip-seed
undefined
/Users/JeanFidele/Projects/pathway/packages/db:
‚ÄâERR_PNPM_RECURSIVE_EXEC_FIRST_FAIL‚Äâ Command failed with exit code 1: prisma migrate reset --force --skip-generate --skip-seed
Applying migration `20250909134602_init`
undefined
/Users/JeanFidele/Projects/pathway/packages/db:
‚ÄâERR_PNPM_RECURSIVE_EXEC_FIRST_FAIL‚Äâ Command failed with exit code 1: prisma migrate reset --force --skip-generate --skip-seed
Applying migration `20250909134602_init`
Applying migration `20250913180105_add_child_concerns_allergies_disabilities`
Applying migration `20250913232320_link_swaprequest_to_assignment`
Applying migration `20250917174707_add_announcement_audience`
Applying migration `20250918201718_suites_billing_orgs`
Applying migration `20251201121500_safeguarding_audit`
Applying migration `20251201144610_pnpm_filter_pathway_api_test_unit_run_tests_by_path_src_common_safeguarding_safeguarding_guard_spec_ts_src_concerns_tests_concerns_service_spec_ts_src_notes_tests_notes_service_spec_ts`
Applying migration `20251201173000_core_tenant_rls`
Applying migration `20251202110000_enforce_rls_flags`

Database reset successful

The following migration(s) have been applied:

migrations/
  ‚îî‚îÄ 20250909134602_init/
    ‚îî‚îÄ migration.sql
  ‚îî‚îÄ 20250913180105_add_child_concerns_allergies_disabilities/
    ‚îî‚îÄ migration.sql
  ‚îî‚îÄ 20250913232320_link_swaprequest_to_assignment/
    ‚îî‚îÄ migration.sql
  ‚îî‚îÄ 20250917174707_add_announcement_audience/
    ‚îî‚îÄ migration.sql
  ‚îî‚îÄ 20250918201718_suites_billing_orgs/
    ‚îî‚îÄ migration.sql
  ‚îî‚îÄ 20251201121500_safeguarding_audit/
    ‚îî‚îÄ migration.sql
  ‚îî‚îÄ 20251201144610_pnpm_filter_pathway_api_test_unit_run_tests_by_path_src_common_safeguarding_safeguarding_guard_spec_ts_src_concerns_tests_concerns_service_spec_ts_src_notes_tests_notes_service_spec_ts/
    ‚îî‚îÄ migration.sql
  ‚îî‚îÄ 20251201173000_core_tenant_rls/
    ‚îî‚îÄ migration.sql
  ‚îî‚îÄ 20251202110000_enforce_rls_flags/
    ‚îî‚îÄ migration.sql

Database reset successful


Database reset successful


Database reset successful


PASS unit src/concerns/tests/concerns.service.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.2] injecting env (15) from ../../.env.test -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [dotenv@17.2.2] injecting env (0) from ../../.env -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

PASS unit src/orgs/tests/orgs.service.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.2] injecting env (15) from ../../.env.test -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [dotenv@17.2.2] injecting env (0) from ../../.env -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [OrgsService] Raw input to register: {
        org: { name: 'Acme Church', slug: 'acme-church' },
        admin: { email: 'admin@acme.test', fullName: 'Admin User' },
        initialTenant: { create: true, name: 'Kids', slug: 'kids' }
      }

      at OrgsService.register (src/orgs/orgs.service.ts:49:13)

    console.log
      [OrgsService] Parsed DTO: {
        org: {
          name: 'Acme Church',
          slug: 'acme-church',
          planCode: 'trial',
          isSuite: true
        },
        admin: { email: 'admin@acme.test', fullName: 'Admin User' },
        initialTenant: { create: true, name: 'Kids', slug: 'kids' }
      }

      at OrgsService.register (src/orgs/orgs.service.ts:51:13)

    console.log
      [OrgsService] Final result: {
        org: { id: 'org_1', name: 'Acme Church', slug: 'acme-church' },
        initialTenant: undefined,
        admin: { invite: { email: 'admin@acme.test', fullName: 'Admin User' } },
        billing: undefined
      }

      at src/orgs/orgs.service.ts:166:17

PASS unit src/announcements/tests/announcements.service.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.2] injecting env (15) from ../../.env.test -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [dotenv@17.2.2] injecting env (0) from ../../.env -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

Database reset successful


PASS unit src/groups/tests/groups.service.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.2] injecting env (15) from ../../.env.test -- tip: üì° version env with Radar: https://dotenvx.com/radar

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [dotenv@17.2.2] injecting env (0) from ../../.env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

PASS unit src/groups/tests/groups.controller.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.2] injecting env (15) from ../../.env.test -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [dotenv@17.2.2] injecting env (0) from ../../.env -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

Environment variables loaded from prisma/.env
Prisma schema loaded from prisma/schema.prisma
Datasource "db": PostgreSQL database "pathway_test_e2e", schema "e2e_w1" at "localhost:5433"
Environment variables loaded from prisma/.env
Prisma schema loaded from prisma/schema.prisma
Datasource "db": PostgreSQL database "pathway_test_e2e", schema "e2e_w1" at "localhost:5433"
Environment variables loaded from prisma/.env
Prisma schema loaded from prisma/schema.prisma

Datasource "db": PostgreSQL database "pathway_test_e2e", schema "e2e_w1" at "localhost:5433"


Environment variables loaded from prisma/.env
Prisma schema loaded from prisma/schema.prisma
Environment variables loaded from prisma/.env
Prisma schema loaded from prisma/schema.prisma
Datasource "db": PostgreSQL database "pathway_test_e2e", schema "e2e_w1" at "localhost:5433"
Error: P3016

The fallback method for database resets failed, meaning Migrate could not clean up the database entirely. Original error: Error code: P1014

The underlying table for model `_prisma_migrations` does not exist.

Error: P1014

The underlying table for model `_prisma_migrations` does not exist.

Error: P3005

The database schema is not empty. Read more about how to baseline an existing production database: https://pris.ly/d/migrate-baseline

Error: Invariant violation: migration persistence is not initialized.
   0: schema_core::state::ApplyMigrations
             at schema-engine/core/src/state.rs:226

Datasource "db": PostgreSQL database "pathway_test_e2e", schema "e2e_w1" at "localhost:5433"
Environment variables loaded from prisma/.env
Prisma schema loaded from prisma/schema.prisma
Datasource "db": PostgreSQL database "pathway_test_e2e", schema "e2e_w1" at "localhost:5433"


Applying migration `20250909134602_init`

undefined
/Users/JeanFidele/Projects/pathway/packages/db:
‚ÄâERR_PNPM_RECURSIVE_EXEC_FIRST_FAIL‚Äâ Command failed with exit code 1: prisma migrate reset --force --skip-generate --skip-seed
undefined
/Users/JeanFidele/Projects/pathway/packages/db:
‚ÄâERR_PNPM_RECURSIVE_EXEC_FIRST_FAIL‚Äâ Command failed with exit code 1: prisma migrate reset --force --skip-generate --skip-seed
undefined
/Users/JeanFidele/Projects/pathway/packages/db:
‚ÄâERR_PNPM_RECURSIVE_EXEC_FIRST_FAIL‚Äâ Command failed with exit code 1: prisma migrate reset --force --skip-generate --skip-seed
undefined
/Users/JeanFidele/Projects/pathway/packages/db:
‚ÄâERR_PNPM_RECURSIVE_EXEC_FIRST_FAIL‚Äâ Command failed with exit code 1: prisma migrate reset --force --skip-generate --skip-seed
PASS unit src/common/safeguarding/safeguarding.guard.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.2] injecting env (15) from ../../.env.test -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [dotenv@17.2.2] injecting env (0) from ../../.env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.warn
      [test.setup.unit] migrate reset failed (continuing): Error: Command failed: pnpm --filter @pathway/db exec prisma migrate reset --force --skip-generate --skip-seed
          at genericNodeError (node:internal/errors:983:15)
          at wrappedFn (node:internal/errors:537:14)
          at checkExecSyncError (node:child_process:890:11)
          at execSync (node:child_process:962:15)
          at run (/Users/JeanFidele/Projects/pathway/apps/api/test.setup.unit.ts:22:15)
          at Object.<anonymous> (/Users/JeanFidele/Projects/pathway/apps/api/test.setup.unit.ts:37:24)
          at Promise.then.completed (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusHook (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:281:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTestsForDescribeBlock (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:95:7)
          at run (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12) {
        status: 1,
        signal: null,
        output: [ null, null, null ],
        pid: 64445,
        stdout: null,
        stderr: null
      }

      61 |     } else {
      62 |       // eslint-disable-next-line no-console
    > 63 |       console.warn(
         |               ^
      64 |         "[test.setup.unit] migrate reset failed (continuing):",
      65 |         firstAttempt,
      66 |       );

      at Object.<anonymous> (test.setup.unit.ts:63:15)

PASS unit src/sessions/tests/sessions.controller.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.2] injecting env (15) from ../../.env.test -- tip: üì° version env with Radar: https://dotenvx.com/radar

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [dotenv@17.2.2] injecting env (0) from ../../.env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.warn
      [test.setup.unit] migrate reset failed (continuing): Error: Command failed: pnpm --filter @pathway/db exec prisma migrate reset --force --skip-generate --skip-seed
          at genericNodeError (node:internal/errors:983:15)
          at wrappedFn (node:internal/errors:537:14)
          at checkExecSyncError (node:child_process:890:11)
          at execSync (node:child_process:962:15)
          at run (/Users/JeanFidele/Projects/pathway/apps/api/test.setup.unit.ts:22:15)
          at Object.<anonymous> (/Users/JeanFidele/Projects/pathway/apps/api/test.setup.unit.ts:37:24)
          at Promise.then.completed (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusHook (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:281:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTestsForDescribeBlock (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:95:7)
          at run (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12) {
        status: 1,
        signal: null,
        output: [ null, null, null ],
        pid: 64446,
        stdout: null,
        stderr: null
      }

      61 |     } else {
      62 |       // eslint-disable-next-line no-console
    > 63 |       console.warn(
         |               ^
      64 |         "[test.setup.unit] migrate reset failed (continuing):",
      65 |         firstAttempt,
      66 |       );

      at Object.<anonymous> (test.setup.unit.ts:63:15)

PASS unit src/billing/tests/billing.service.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.2] injecting env (15) from ../../.env.test -- tip: ‚öôÔ∏è  override existing env vars with { override: true }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [dotenv@17.2.2] injecting env (0) from ../../.env -- tip: üì° auto-backup env with Radar: https://dotenvx.com/radar

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.warn
      [test.setup.unit] migrate reset failed (continuing): Error: Command failed: pnpm --filter @pathway/db exec prisma migrate reset --force --skip-generate --skip-seed
          at genericNodeError (node:internal/errors:983:15)
          at wrappedFn (node:internal/errors:537:14)
          at checkExecSyncError (node:child_process:890:11)
          at execSync (node:child_process:962:15)
          at run (/Users/JeanFidele/Projects/pathway/apps/api/test.setup.unit.ts:22:15)
          at Object.<anonymous> (/Users/JeanFidele/Projects/pathway/apps/api/test.setup.unit.ts:37:24)
          at Promise.then.completed (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusHook (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:281:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTestsForDescribeBlock (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:95:7)
          at run (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12) {
        status: 1,
        signal: null,
        output: [ null, null, null ],
        pid: 64486,
        stdout: null,
        stderr: null
      }

      61 |     } else {
      62 |       // eslint-disable-next-line no-console
    > 63 |       console.warn(
         |               ^
      64 |         "[test.setup.unit] migrate reset failed (continuing):",
      65 |         firstAttempt,
      66 |       );

      at Object.<anonymous> (test.setup.unit.ts:63:15)

Applying migration `20250909134602_init`
Applying migration `20250913180105_add_child_concerns_allergies_disabilities`
Applying migration `20250913232320_link_swaprequest_to_assignment`
Applying migration `20250917174707_add_announcement_audience`
PASS unit src/swaps/tests/swaps.service.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.2] injecting env (15) from ../../.env.test -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [dotenv@17.2.2] injecting env (0) from ../../.env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.warn
      [test.setup.unit] migrate reset failed (continuing): Error: Command failed: pnpm --filter @pathway/db exec prisma migrate reset --force --skip-generate --skip-seed
          at genericNodeError (node:internal/errors:983:15)
          at wrappedFn (node:internal/errors:537:14)
          at checkExecSyncError (node:child_process:890:11)
          at execSync (node:child_process:962:15)
          at run (/Users/JeanFidele/Projects/pathway/apps/api/test.setup.unit.ts:22:15)
          at Object.<anonymous> (/Users/JeanFidele/Projects/pathway/apps/api/test.setup.unit.ts:37:24)
          at Promise.then.completed (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusHook (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:281:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTestsForDescribeBlock (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:95:7)
          at run (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/JeanFidele/Projects/pathway/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12) {
        status: 1,
        signal: null,
        output: [ null, null, null ],
        pid: 64444,
        stdout: null,
        stderr: null
      }

      61 |     } else {
      62 |       // eslint-disable-next-line no-console
    > 63 |       console.warn(
         |               ^
      64 |         "[test.setup.unit] migrate reset failed (continuing):",
      65 |         firstAttempt,
      66 |       );

      at Object.<anonymous> (test.setup.unit.ts:63:15)

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Update available 5.22.0 -> 7.1.0                       ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  This is a major update - please follow the guide at    ‚îÇ
‚îÇ  https://pris.ly/d/major-version-upgrade                ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  Run the following to update                            ‚îÇ
‚îÇ    npm i --save-dev prisma@latest                       ‚îÇ
‚îÇ    npm i @prisma/client@latest                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Update available 5.22.0 -> 7.1.0                       ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  This is a major update - please follow the guide at    ‚îÇ
‚îÇ  https://pris.ly/d/major-version-upgrade                ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  Run the following to update                            ‚îÇ
‚îÇ    npm i --save-dev prisma@latest                       ‚îÇ
‚îÇ    npm i @prisma/client@latest                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
PASS unit src/announcements/tests/announcements.controller.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.2] injecting env (15) from ../../.env.test -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [dotenv@17.2.2] injecting env (0) from ../../.env -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

Applying migration `20250918201718_suites_billing_orgs`
Applying migration `20251201121500_safeguarding_audit`
Applying migration `20251201144610_pnpm_filter_pathway_api_test_unit_run_tests_by_path_src_common_safeguarding_safeguarding_guard_spec_ts_src_concerns_tests_concerns_service_spec_ts_src_notes_tests_notes_service_spec_ts`
Applying migration `20251201173000_core_tenant_rls`
Applying migration `20251202110000_enforce_rls_flags`

Database reset successful

The following migration(s) have been applied:

migrations/
  ‚îî‚îÄ 20250909134602_init/
    ‚îî‚îÄ migration.sql
  ‚îî‚îÄ 20250913180105_add_child_concerns_allergies_disabilities/
    ‚îî‚îÄ migration.sql
  ‚îî‚îÄ 20250913232320_link_swaprequest_to_assignment/
    ‚îî‚îÄ migration.sql
  ‚îî‚îÄ 20250917174707_add_announcement_audience/
    ‚îî‚îÄ migration.sql
  ‚îî‚îÄ 20250918201718_suites_billing_orgs/
    ‚îî‚îÄ migration.sql
  ‚îî‚îÄ 20251201121500_safeguarding_audit/
    ‚îî‚îÄ migration.sql
  ‚îî‚îÄ 20251201144610_pnpm_filter_pathway_api_test_unit_run_tests_by_path_src_common_safeguarding_safeguarding_guard_spec_ts_src_concerns_tests_concerns_service_spec_ts_src_notes_tests_notes_service_spec_ts/
    ‚îî‚îÄ migration.sql
  ‚îî‚îÄ 20251201173000_core_tenant_rls/
    ‚îî‚îÄ migration.sql
  ‚îî‚îÄ 20251202110000_enforce_rls_flags/
    ‚îî‚îÄ migration.sql

Database reset successful


Environment variables loaded from prisma/.env
Environment variables loaded from prisma/.env
Prisma schema loaded from prisma/schema.prisma
Environment variables loaded from prisma/.env
Prisma schema loaded from prisma/schema.prisma
Prisma schema loaded from prisma/schema.prisma
Datasource "db": PostgreSQL database "pathway_test_e2e", schema "e2e_w1" at "localhost:5433"
Datasource "db": PostgreSQL database "pathway_test_e2e", schema "e2e_w1" at "localhost:5433"
Datasource "db": PostgreSQL database "pathway_test_e2e", schema "e2e_w1" at "localhost:5433"
PASS unit src/swaps/tests/swaps.controller.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.2] injecting env (15) from ../../.env.test -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [dotenv@17.2.2] injecting env (0) from ../../.env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)




Applying migration `20250909134602_init`
Applying migration `20250913180105_add_child_concerns_allergies_disabilities`
Applying migration `20250913232320_link_swaprequest_to_assignment`
PASS unit src/assignments/tests/assignments.service.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.2] injecting env (15) from ../../.env.test -- tip: üì° observe env with Radar: https://dotenvx.com/radar

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [dotenv@17.2.2] injecting env (0) from ../../.env -- tip: üì° observe env with Radar: https://dotenvx.com/radar

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

PASS unit src/orgs/tests/orgs.controller.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.2] injecting env (15) from ../../.env.test -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [dotenv@17.2.2] injecting env (0) from ../../.env -- tip: üì° observe env with Radar: https://dotenvx.com/radar

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

PASS unit src/billing/tests/billing.controller.spec.ts
  ‚óè Console

    console.log
      [dotenv@17.2.2] injecting env (15) from ../../.env.test -- tip: üì° observe env with Radar: https://dotenvx.com/radar

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

    console.log
      [dotenv@17.2.2] injecting env (0) from ../../.env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

Applying migration `20250917174707_add_announcement_audience`
Applying migration `20250918201718_suites_billing_orgs`
Applying migration `20251201121500_safeguarding_audit`
Applying migration `20251201144610_pnpm_filter_pathway_api_test_unit_run_tests_by_path_src_common_safeguarding_safeguarding_guard_spec_ts_src_concerns_tests_concerns_service_spec_ts_src_notes_tests_notes_service_spec_ts`
Applying migration `20251201173000_core_tenant_rls`
Applying migration `20251202110000_enforce_rls_flags`

Database reset successful

The following migration(s) have been applied:

migrations/
  ‚îî‚îÄ 20250909134602_init/
    ‚îî‚îÄ migration.sql
  ‚îî‚îÄ 20250913180105_add_child_concerns_allergies_disabilities/
    ‚îî‚îÄ migration.sql
  ‚îî‚îÄ 20250913232320_link_swaprequest_to_assignment/
    ‚îî‚îÄ migration.sql
  ‚îî‚îÄ 20250917174707_add_announcement_audience/
    ‚îî‚îÄ migration.sql
  ‚îî‚îÄ 20250918201718_suites_billing_orgs/
    ‚îî‚îÄ migration.sql
  ‚îî‚îÄ 20251201121500_safeguarding_audit/
    ‚îî‚îÄ migration.sql
  ‚îî‚îÄ 20251201144610_pnpm_filter_pathway_api_test_unit_run_tests_by_path_src_common_safeguarding_safeguarding_guard_spec_ts_src_concerns_tests_concerns_service_spec_ts_src_notes_tests_notes_service_spec_ts/
    ‚îî‚îÄ migration.sql
  ‚îî‚îÄ 20251201173000_core_tenant_rls/
    ‚îî‚îÄ migration.sql
  ‚îî‚îÄ 20251202110000_enforce_rls_flags/
    ‚îî‚îÄ migration.sql

Database reset successful


Database reset successful



Summary of all failing tests
FAIL src/children/tests/children.e2e.spec.ts
  ‚óè Children (e2e) ‚Ä∫ GET /children should return array

    PrismaClientKnownRequestError: 
    Invalid `prisma.$queryRaw()` invocation:


    Raw query failed. Code: `42P01`. Message: `relation "_prisma_migrations" does not exist`

      112 |   // Quick smoke check: ensure the test role can read migrations metadata.
      113 |   try {
    > 114 |     await prisma.$queryRaw`SELECT 1 FROM "_prisma_migrations" LIMIT 1`;
          |     ^
      115 |   } catch (error) {
      116 |     console.error(
      117 |       "[test.setup.e2e] Smoke check failed: cannot read _prisma_migrations. Ensure schema is migrated and test role has USAGE/SELECT grants. Tests will likely fail.",

      at $n.handleRequestError (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:7315)
      at $n.handleAndLogRequestError (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (test.setup.e2e.ts:114:5)

  ‚óè Children (e2e) ‚Ä∫ GET /children should return array

    PrismaClientKnownRequestError: 
    Invalid `tx.group.create()` invocation in
    /Users/JeanFidele/Projects/pathway/apps/api/src/children/tests/children.e2e.spec.ts:35:32

      32 await app.init();
      33 
      34 await withTenantRlsContext(tenantId, orgId, async (tx) => {
    ‚Üí 35   const g = await tx.group.create(
    Foreign key constraint violated: `Group_tenantId_fkey (index)`

      33 |
      34 |     await withTenantRlsContext(tenantId, orgId, async (tx) => {
    > 35 |       const g = await tx.group.create({
         |                 ^
      36 |         data: { name: `Sparks-${nonce}`, minAge: 5, maxAge: 7, tenantId },
      37 |         select: { id: true },
      38 |       });

      at $n.handleRequestError (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:7315)
      at $n.handleAndLogRequestError (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:130:9633)
      at src/children/tests/children.e2e.spec.ts:35:17
      at Proxy._transactionWithCallback (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:130:8000)
      at Object.<anonymous> (src/children/tests/children.e2e.spec.ts:34:5)

  ‚óè Children (e2e) ‚Ä∫ POST /children should create a child (minimal)

    PrismaClientKnownRequestError: 
    Invalid `prisma.$queryRaw()` invocation:


    Raw query failed. Code: `42P01`. Message: `relation "_prisma_migrations" does not exist`

      112 |   // Quick smoke check: ensure the test role can read migrations metadata.
      113 |   try {
    > 114 |     await prisma.$queryRaw`SELECT 1 FROM "_prisma_migrations" LIMIT 1`;
          |     ^
      115 |   } catch (error) {
      116 |     console.error(
      117 |       "[test.setup.e2e] Smoke check failed: cannot read _prisma_migrations. Ensure schema is migrated and test role has USAGE/SELECT grants. Tests will likely fail.",

      at $n.handleRequestError (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:7315)
      at $n.handleAndLogRequestError (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (test.setup.e2e.ts:114:5)

  ‚óè Children (e2e) ‚Ä∫ POST /children should create a child (minimal)

    PrismaClientKnownRequestError: 
    Invalid `tx.group.create()` invocation in
    /Users/JeanFidele/Projects/pathway/apps/api/src/children/tests/children.e2e.spec.ts:35:32

      32 await app.init();
      33 
      34 await withTenantRlsContext(tenantId, orgId, async (tx) => {
    ‚Üí 35   const g = await tx.group.create(
    Foreign key constraint violated: `Group_tenantId_fkey (index)`

      33 |
      34 |     await withTenantRlsContext(tenantId, orgId, async (tx) => {
    > 35 |       const g = await tx.group.create({
         |                 ^
      36 |         data: { name: `Sparks-${nonce}`, minAge: 5, maxAge: 7, tenantId },
      37 |         select: { id: true },
      38 |       });

      at $n.handleRequestError (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:7315)
      at $n.handleAndLogRequestError (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:130:9633)
      at src/children/tests/children.e2e.spec.ts:35:17
      at Proxy._transactionWithCallback (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:130:8000)
      at Object.<anonymous> (src/children/tests/children.e2e.spec.ts:34:5)

  ‚óè Children (e2e) ‚Ä∫ GET /children/:id should return the created child

    PrismaClientKnownRequestError: 
    Invalid `prisma.$queryRaw()` invocation:


    Raw query failed. Code: `42P01`. Message: `relation "_prisma_migrations" does not exist`

      112 |   // Quick smoke check: ensure the test role can read migrations metadata.
      113 |   try {
    > 114 |     await prisma.$queryRaw`SELECT 1 FROM "_prisma_migrations" LIMIT 1`;
          |     ^
      115 |   } catch (error) {
      116 |     console.error(
      117 |       "[test.setup.e2e] Smoke check failed: cannot read _prisma_migrations. Ensure schema is migrated and test role has USAGE/SELECT grants. Tests will likely fail.",

      at $n.handleRequestError (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:7315)
      at $n.handleAndLogRequestError (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (test.setup.e2e.ts:114:5)

  ‚óè Children (e2e) ‚Ä∫ GET /children/:id should return the created child

    PrismaClientKnownRequestError: 
    Invalid `tx.group.create()` invocation in
    /Users/JeanFidele/Projects/pathway/apps/api/src/children/tests/children.e2e.spec.ts:35:32

      32 await app.init();
      33 
      34 await withTenantRlsContext(tenantId, orgId, async (tx) => {
    ‚Üí 35   const g = await tx.group.create(
    Foreign key constraint violated: `Group_tenantId_fkey (index)`

      33 |
      34 |     await withTenantRlsContext(tenantId, orgId, async (tx) => {
    > 35 |       const g = await tx.group.create({
         |                 ^
      36 |         data: { name: `Sparks-${nonce}`, minAge: 5, maxAge: 7, tenantId },
      37 |         select: { id: true },
      38 |       });

      at $n.handleRequestError (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:7315)
      at $n.handleAndLogRequestError (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:130:9633)
      at src/children/tests/children.e2e.spec.ts:35:17
      at Proxy._transactionWithCallback (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:130:8000)
      at Object.<anonymous> (src/children/tests/children.e2e.spec.ts:34:5)

  ‚óè Children (e2e) ‚Ä∫ PATCH /children/:id should update group and guardians

    PrismaClientKnownRequestError: 
    Invalid `prisma.$queryRaw()` invocation:


    Raw query failed. Code: `42P01`. Message: `relation "_prisma_migrations" does not exist`

      112 |   // Quick smoke check: ensure the test role can read migrations metadata.
      113 |   try {
    > 114 |     await prisma.$queryRaw`SELECT 1 FROM "_prisma_migrations" LIMIT 1`;
          |     ^
      115 |   } catch (error) {
      116 |     console.error(
      117 |       "[test.setup.e2e] Smoke check failed: cannot read _prisma_migrations. Ensure schema is migrated and test role has USAGE/SELECT grants. Tests will likely fail.",

      at $n.handleRequestError (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:7315)
      at $n.handleAndLogRequestError (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (test.setup.e2e.ts:114:5)

  ‚óè Children (e2e) ‚Ä∫ PATCH /children/:id should update group and guardians

    PrismaClientKnownRequestError: 
    Invalid `tx.group.create()` invocation in
    /Users/JeanFidele/Projects/pathway/apps/api/src/children/tests/children.e2e.spec.ts:35:32

      32 await app.init();
      33 
      34 await withTenantRlsContext(tenantId, orgId, async (tx) => {
    ‚Üí 35   const g = await tx.group.create(
    Foreign key constraint violated: `Group_tenantId_fkey (index)`

      33 |
      34 |     await withTenantRlsContext(tenantId, orgId, async (tx) => {
    > 35 |       const g = await tx.group.create({
         |                 ^
      36 |         data: { name: `Sparks-${nonce}`, minAge: 5, maxAge: 7, tenantId },
      37 |         select: { id: true },
      38 |       });

      at $n.handleRequestError (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:7315)
      at $n.handleAndLogRequestError (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:130:9633)
      at src/children/tests/children.e2e.spec.ts:35:17
      at Proxy._transactionWithCallback (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:130:8000)
      at Object.<anonymous> (src/children/tests/children.e2e.spec.ts:34:5)

  ‚óè Children (e2e) ‚Ä∫ POST /children invalid body should 400 (missing allergies)

    PrismaClientKnownRequestError: 
    Invalid `prisma.$queryRaw()` invocation:


    Raw query failed. Code: `42P01`. Message: `relation "_prisma_migrations" does not exist`

      112 |   // Quick smoke check: ensure the test role can read migrations metadata.
      113 |   try {
    > 114 |     await prisma.$queryRaw`SELECT 1 FROM "_prisma_migrations" LIMIT 1`;
          |     ^
      115 |   } catch (error) {
      116 |     console.error(
      117 |       "[test.setup.e2e] Smoke check failed: cannot read _prisma_migrations. Ensure schema is migrated and test role has USAGE/SELECT grants. Tests will likely fail.",

      at $n.handleRequestError (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:7315)
      at $n.handleAndLogRequestError (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (test.setup.e2e.ts:114:5)

  ‚óè Children (e2e) ‚Ä∫ POST /children invalid body should 400 (missing allergies)

    PrismaClientKnownRequestError: 
    Invalid `tx.group.create()` invocation in
    /Users/JeanFidele/Projects/pathway/apps/api/src/children/tests/children.e2e.spec.ts:35:32

      32 await app.init();
      33 
      34 await withTenantRlsContext(tenantId, orgId, async (tx) => {
    ‚Üí 35   const g = await tx.group.create(
    Foreign key constraint violated: `Group_tenantId_fkey (index)`

      33 |
      34 |     await withTenantRlsContext(tenantId, orgId, async (tx) => {
    > 35 |       const g = await tx.group.create({
         |                 ^
      36 |         data: { name: `Sparks-${nonce}`, minAge: 5, maxAge: 7, tenantId },
      37 |         select: { id: true },
      38 |       });

      at $n.handleRequestError (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:7315)
      at $n.handleAndLogRequestError (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:130:9633)
      at src/children/tests/children.e2e.spec.ts:35:17
      at Proxy._transactionWithCallback (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:130:8000)
      at Object.<anonymous> (src/children/tests/children.e2e.spec.ts:34:5)

  ‚óè Children (e2e) ‚Ä∫ POST /children group from another tenant should 400

    PrismaClientKnownRequestError: 
    Invalid `prisma.$queryRaw()` invocation:


    Raw query failed. Code: `42P01`. Message: `relation "_prisma_migrations" does not exist`

      112 |   // Quick smoke check: ensure the test role can read migrations metadata.
      113 |   try {
    > 114 |     await prisma.$queryRaw`SELECT 1 FROM "_prisma_migrations" LIMIT 1`;
          |     ^
      115 |   } catch (error) {
      116 |     console.error(
      117 |       "[test.setup.e2e] Smoke check failed: cannot read _prisma_migrations. Ensure schema is migrated and test role has USAGE/SELECT grants. Tests will likely fail.",

      at $n.handleRequestError (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:7315)
      at $n.handleAndLogRequestError (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:130:9633)
      at Object.<anonymous> (test.setup.e2e.ts:114:5)

  ‚óè Children (e2e) ‚Ä∫ POST /children group from another tenant should 400

    PrismaClientKnownRequestError: 
    Invalid `tx.group.create()` invocation in
    /Users/JeanFidele/Projects/pathway/apps/api/src/children/tests/children.e2e.spec.ts:35:32

      32 await app.init();
      33 
      34 await withTenantRlsContext(tenantId, orgId, async (tx) => {
    ‚Üí 35   const g = await tx.group.create(
    Foreign key constraint violated: `Group_tenantId_fkey (index)`

      33 |
      34 |     await withTenantRlsContext(tenantId, orgId, async (tx) => {
    > 35 |       const g = await tx.group.create({
         |                 ^
      36 |         data: { name: `Sparks-${nonce}`, minAge: 5, maxAge: 7, tenantId },
      37 |         select: { id: true },
      38 |       });

      at $n.handleRequestError (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:7315)
      at $n.handleAndLogRequestError (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:6623)
      at $n.request (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:121:6307)
      at l (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:130:9633)
      at src/children/tests/children.e2e.spec.ts:35:17
      at Proxy._transactionWithCallback (../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:130:8000)
      at Object.<anonymous> (src/children/tests/children.e2e.spec.ts:34:5)


Test Suites: 1 failed, 47 passed, 48 total
Tests:       6 failed, 325 passed, 331 total
Snapshots:   0 total
Time:        10.46 s, estimated 11 s
Ran all test suites in 2 projects.
‚ÄâELIFECYCLE‚Äâ Test failed. See above for more details.
