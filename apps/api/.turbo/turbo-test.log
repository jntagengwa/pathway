
> @pathway/api@0.1.0 test /Users/JeanFidele/Projects/pathway/apps/api
> jest

  console.log
    [dotenv@17.2.2] injecting env (0) from ../../../.env -- tip: ðŸ” encrypt with Dotenvx: https://dotenvx.com

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

  console.log
    [dotenv@17.2.2] injecting env (0) from ../../../.env -- tip: ðŸ“¡ version env with Radar: https://dotenvx.com/radar

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

  console.log
    [dotenv@17.2.2] injecting env (0) from ../../../.env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

  console.log
    [dotenv@17.2.2] injecting env (0) from ../../../.env -- tip: ðŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

  console.log
    [dotenv@17.2.2] injecting env (0) from ../../../.env -- tip: âš™ï¸  suppress all logs with { quiet: true }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

  console.log
    [dotenv@17.2.2] injecting env (0) from ../../../.env -- tip: âš™ï¸  override existing env vars with { override: true }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

  console.log
    [dotenv@17.2.2] injecting env (0) from ../../../.env -- tip: ðŸ“¡ version env with Radar: https://dotenvx.com/radar

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

  console.log
    [dotenv@17.2.2] injecting env (0) from ../../../.env -- tip: âš™ï¸  override existing env vars with { override: true }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

  console.log
    [dotenv@17.2.2] injecting env (0) from ../../../.env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

  console.log
    [dotenv@17.2.2] injecting env (0) from ../../../.env -- tip: ðŸ” encrypt with Dotenvx: https://dotenvx.com

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

PASS src/users/tests/users.controller.spec.ts
  UsersController
    âœ“ should be defined (7 ms)
    âœ“ list should return array (1 ms)
    âœ“ getById should return a user when found (1 ms)
    âœ“ getById should throw NotFound when missing (1 ms)
    âœ“ create should call service and return user (1 ms)

PASS src/tenants/tests/tenants.controller.spec.ts
  TenantsController
    âœ“ should be defined (21 ms)
    âœ“ list should return array (11 ms)
    âœ“ bySlug should return a tenant (2 ms)
    âœ“ create should call service and return tenant (1 ms)

PASS src/groups/tests/groups.e2e-spec.ts
  Groups (e2e)
    âœ“ GET /groups should return array (20 ms)
    âœ“ POST /groups should create a group (21 ms)
    âœ“ GET /groups/:id should return the created group (4 ms)
    âœ“ PATCH /groups/:id should update group (17 ms)
    âœ“ POST /groups duplicate name for same tenant should 400 (31 ms)
    âœ“ POST /groups invalid ages should 400 (2 ms)

PASS src/users/tests/users.service.spec.ts
  UsersService
    list
      âœ“ returns users (3 ms)
    getById
      âœ“ returns a user when found (1 ms)
      âœ“ throws NotFound when missing
    create
      âœ“ normalizes email and creates user (with tenant connect) (2 ms)
      âœ“ connects children when provided (and all exist in same tenant)
      âœ“ 400 when any child id is missing (1 ms)
      âœ“ 400 when any child is cross-tenant
      âœ“ throws BadRequest when duplicate email (pre-check)
      âœ“ throws BadRequest when unique constraint race (P2002)
      âœ“ throws BadRequest for invalid email (ZodError mapping)
    update
      âœ“ updates user fields and returns selection
      âœ“ lowercases email on update when provided
      âœ“ replaces children set when provided (same tenant) (1 ms)
      âœ“ 404 when user not found before validation
      âœ“ 400 when updating children with missing ids
      âœ“ 400 when updating children cross-tenant (target tenant is current)
      âœ“ throws BadRequest on unique email conflict (P2002)
      âœ“ throws NotFound on missing user (P2025) when update bubbles

PASS src/tenants/tests/tenants.service.spec.ts
  TenantsService
    list
      âœ“ returns tenants (3 ms)
    getBySlug
      âœ“ returns a tenant when found
      âœ“ throws NotFound when missing
    create
      âœ“ lowercases slug and creates tenant (1 ms)
      âœ“ throws BadRequest when slug already exists (pre-check) (1 ms)
      âœ“ throws BadRequest when unique constraint race occurs (P2002)

PASS src/groups/tests/groups.controller.spec.ts
  GroupsController
    âœ“ should be defined (7 ms)
    âœ“ list should return array (1 ms)
    âœ“ getById should return a group when found (2 ms)
    âœ“ getById should throw NotFound when missing
    âœ“ create should call service and return group (2 ms)
    âœ“ update should call service and return updated group (1 ms)

PASS src/groups/tests/groups.service.spec.ts
  GroupsService
    list
      âœ“ returns groups (3 ms)
    getById
      âœ“ returns a group when found
      âœ“ throws NotFound when missing (1 ms)
    create
      âœ“ validates & creates with tenant connect (1 ms)
      âœ“ throws BadRequest when duplicate (pre-check)
      âœ“ throws BadRequest when unique constraint race (P2002) (1 ms)
      âœ“ throws BadRequest for invalid ages (min>max)
    update
      âœ“ updates name and ages (1 ms)
      âœ“ throws BadRequest when unique name conflict (P2002)
      âœ“ throws NotFound when group missing (P2025)
      âœ“ throws BadRequest when invalid ages provided

PASS src/health/tests/health.e2e-spec.ts
  HealthController (e2e)
    âœ“ /health (GET) (23 ms)

PASS src/tenants/tests/tenants.e2e-spec.ts
  Tenants (e2e)
    âœ“ GET /tenants should return array (11 ms)
    âœ“ POST /tenants should create a tenant (10 ms)
    âœ“ GET /tenants/:slug should return the created tenant (3 ms)
    âœ“ POST /tenants duplicate slug should 400 (3 ms)
    âœ“ GET /tenants/unknown should 404 (4 ms)

PASS src/users/tests/users.e2e-spec.ts
  Users (e2e)
    âœ“ GET /users should return array (15 ms)
    âœ“ POST /users should create a user (14 ms)
    âœ“ GET /users/:id should return the created user (3 ms)
    âœ“ POST /users duplicate email should 400 (3 ms)
    âœ“ POST /users invalid email should 400 (1 ms)

Test Suites: 10 passed, 10 total
Tests:       67 passed, 67 total
Snapshots:   0 total
Time:        4.44 s
Ran all test suites.
