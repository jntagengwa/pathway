
> @pathway/api@0.1.0 test /Users/JeanFidele/Projects/pathway/apps/api
> jest

  console.log
    [dotenv@17.2.2] injecting env (0) from ../../../.env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

  console.log
    [dotenv@17.2.2] injecting env (0) from ../../../.env -- tip: âš™ï¸  suppress all logs with { quiet: true }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

  console.log
    [dotenv@17.2.2] injecting env (0) from ../../../.env -- tip: ðŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

  console.log
    [dotenv@17.2.2] injecting env (0) from ../../../.env -- tip: ðŸ” prevent building .env in docker: https://dotenvx.com/prebuild

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

  console.log
    [dotenv@17.2.2] injecting env (0) from ../../../.env -- tip: ðŸ“¡ observe env with Radar: https://dotenvx.com/radar

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

  console.log
    [dotenv@17.2.2] injecting env (0) from ../../../.env -- tip: ðŸ“¡ observe env with Radar: https://dotenvx.com/radar

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

  console.log
    [dotenv@17.2.2] injecting env (0) from ../../../.env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

  console.log
    [dotenv@17.2.2] injecting env (0) from ../../../.env -- tip: ðŸ” prevent building .env in docker: https://dotenvx.com/prebuild

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

PASS src/attendance/tests/attendance.service.spec.ts
  AttendanceService
    list
      âœ“ returns attendance ordered by timestamp desc (3 ms)
    getById
      âœ“ returns a record when found (1 ms)
      âœ“ throws NotFound when missing
    create
      âœ“ throws when child not found
      âœ“ throws when group not found (1 ms)
      âœ“ throws when child and group are in different tenants
      âœ“ creates with default timestamp when not provided
      âœ“ creates with provided timestamp (1 ms)
    update
      âœ“ throws NotFound if attendance missing
      âœ“ updates present only
      âœ“ throws when changing group across tenants
      âœ“ connects new group when same tenant

  console.log
    [dotenv@17.2.2] injecting env (0) from ../../../.env -- tip: âš™ï¸  suppress all logs with { quiet: true }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

  console.log
    [dotenv@17.2.2] injecting env (0) from ../../../.env -- tip: âš™ï¸  override existing env vars with { override: true }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

  console.log
    [dotenv@17.2.2] injecting env (0) from ../../../.env -- tip: ðŸ“¡ observe env with Radar: https://dotenvx.com/radar

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

  console.log
    [dotenv@17.2.2] injecting env (0) from ../../../.env -- tip: âš™ï¸  override existing env vars with { override: true }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

PASS src/children/tests/children.controller.spec.ts
  ChildrenController
    âœ“ should be defined (8 ms)
    âœ“ list should return array (1 ms)
    âœ“ getById should return a child (1 ms)
    âœ“ create should validate and call service (1 ms)
    âœ“ create should 400 on invalid body (missing allergies) (2 ms)
    âœ“ update should validate and call service (1 ms)
    âœ“ update should 400 on invalid uuid for groupId (1 ms)

  console.log
    [dotenv@17.2.2] injecting env (0) from ../../../.env -- tip: ðŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

PASS src/groups/tests/groups.controller.spec.ts
  GroupsController
    âœ“ should be defined (1 ms)
    âœ“ list should return array (1 ms)
    âœ“ getById should return a group when found (1 ms)
    âœ“ getById should throw NotFound when missing
    âœ“ create should call service and return group (1 ms)
    âœ“ update should call service and return updated group (8 ms)

  console.log
    [dotenv@17.2.2] injecting env (0) from ../../../.env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

PASS src/users/tests/users.controller.spec.ts
  UsersController
    âœ“ should be defined (6 ms)
    âœ“ list should return array (11 ms)
    âœ“ getById should return a user when found (1 ms)
    âœ“ getById should throw NotFound when missing (1 ms)
    âœ“ create should call service and return user (1 ms)

  console.log
    [dotenv@17.2.2] injecting env (0) from ../../../.env -- tip: ðŸ“¡ auto-backup env with Radar: https://dotenvx.com/radar

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

PASS src/tenants/tests/tenants.service.spec.ts
  TenantsService
    list
      âœ“ returns tenants
    getBySlug
      âœ“ returns a tenant when found (1 ms)
      âœ“ throws NotFound when missing
    create
      âœ“ lowercases slug and creates tenant
      âœ“ creates tenant and connects optional relations when provided (4 ms)
      âœ“ throws BadRequest when slug already exists (pre-check)
      âœ“ throws BadRequest when unique constraint race occurs (P2002)

  console.log
    [dotenv@17.2.2] injecting env (0) from ../../../.env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

      at _log (../../node_modules/.pnpm/dotenv@17.2.2/node_modules/dotenv/lib/main.js:139:11)

PASS src/users/tests/users.service.spec.ts
  UsersService
    list
      âœ“ returns users (1 ms)
    getById
      âœ“ returns a user when found
      âœ“ throws NotFound when missing
    create
      âœ“ normalizes email and creates user (with tenant connect) (1 ms)
      âœ“ connects children when provided (and all exist in same tenant)
      âœ“ 400 when any child id is missing
      âœ“ 400 when any child is cross-tenant
      âœ“ throws BadRequest when duplicate email (pre-check)
      âœ“ throws BadRequest when unique constraint race (P2002)
      âœ“ throws BadRequest for invalid email (ZodError mapping) (1 ms)
    update
      âœ“ updates user fields and returns selection
      âœ“ lowercases email on update when provided
      âœ“ replaces children set when provided (same tenant)
      âœ“ 404 when user not found before validation
      âœ“ 400 when updating children with missing ids
      âœ“ 400 when updating children cross-tenant (target tenant is current) (1 ms)
      âœ“ throws BadRequest on unique email conflict (P2002)
      âœ“ throws NotFound on missing user (P2025) when update bubbles

PASS src/groups/tests/groups.service.spec.ts
  GroupsService
    list
      âœ“ returns groups
    getById
      âœ“ returns a group when found (1 ms)
      âœ“ throws NotFound when missing
    create
      âœ“ validates & creates with tenant connect
      âœ“ throws BadRequest when duplicate (pre-check)
      âœ“ throws BadRequest when unique constraint race (P2002)
      âœ“ throws BadRequest for invalid ages (min>max)
    update
      âœ“ updates name and ages (1 ms)
      âœ“ throws BadRequest when unique name conflict (P2002)
      âœ“ throws NotFound when group missing (P2025)
      âœ“ throws BadRequest when invalid ages provided (1 ms)

PASS src/children/tests/children.e2e.spec.ts
  Children (e2e)
    âœ“ GET /children should return array (33 ms)
    âœ“ POST /children should create a child (minimal) (32 ms)
    âœ“ GET /children/:id should return the created child (7 ms)
    âœ“ PATCH /children/:id should update group and guardians (32 ms)
    âœ“ POST /children invalid body should 400 (missing allergies) (3 ms)
    âœ“ POST /children group from another tenant should 400 (10 ms)

PASS src/children/tests/children.service.spec.ts
  ChildrenService
    list
      âœ“ returns children (optionally by tenant) (6 ms)
    getById
      âœ“ returns a child when found
      âœ“ throws NotFound when missing (1 ms)
    create
      âœ“ creates child with tenant only
      âœ“ validates group belongs to same tenant (1 ms)
      âœ“ validates guardians belong to tenant and exist
      âœ“ throws when tenant not found
    update
      âœ“ updates standard fields (1 ms)
      âœ“ validates group tenant on update
      âœ“ replaces guardians set when provided
      âœ“ throws NotFound if child missing on update

PASS src/tenants/tests/tenants.controller.spec.ts
  TenantsController
    âœ“ should be defined (6 ms)
    âœ“ list should return array (1 ms)
    âœ“ bySlug should return a tenant (4 ms)
    âœ“ create should call service and return tenant (2 ms)
    âœ“ create should accept optional relation arrays and pass them to service (2 ms)
    âœ“ create should 400 on invalid slug (fails DTO validation) (1 ms)

PASS src/tenants/tests/tenants.e2e-spec.ts
  Tenants (e2e)
    âœ“ GET /tenants should return array (14 ms)
    âœ“ POST /tenants should create a tenant (11 ms)
    âœ“ GET /tenants/:slug should return the created tenant (3 ms)
    âœ“ POST /tenants duplicate slug should 400 (3 ms)
    âœ“ POST /tenants invalid slug should 400 (controller DTO validation) (3 ms)
    âœ“ GET /tenants/unknown should 404 (2 ms)

PASS src/health/tests/health.e2e-spec.ts
  HealthController (e2e)
    âœ“ /health (GET) (28 ms)

PASS src/users/tests/users.e2e-spec.ts
  Users (e2e)
    âœ“ GET /users should return array (14 ms)
    âœ“ POST /users should create a user (14 ms)
    âœ“ GET /users/:id should return the created user (4 ms)
    âœ“ POST /users duplicate email should 400 (3 ms)
    âœ“ POST /users invalid email should 400 (2 ms)

PASS src/groups/tests/groups.e2e-spec.ts
  Groups (e2e)
    âœ“ GET /groups should return array (14 ms)
    âœ“ POST /groups should create a group (12 ms)
    âœ“ GET /groups/:id should return the created group (5 ms)
    âœ“ PATCH /groups/:id should update group (3 ms)
    âœ“ POST /groups duplicate name for same tenant should 400 (7 ms)
    âœ“ POST /groups invalid ages should 400 (2 ms)

PASS src/attendance/tests/attendance.e2e.spec.ts
  Groups (e2e)
    âœ“ POST /groups should create a group for tenant (18 ms)

PASS src/attendance/tests/attendance.controller.spec.ts
  AttendanceController
    âœ“ should be defined (6 ms)
    âœ“ list should return array (1 ms)
    âœ“ getById should return a record
    âœ“ create should validate and call service (2 ms)
    âœ“ create should 400 on invalid body (missing present) (2 ms)
    âœ“ update should validate and call service (1 ms)
    âœ“ update should 400 on invalid uuid in groupId (1 ms)

Test Suites: 16 passed, 16 total
Tests:       115 passed, 115 total
Snapshots:   0 total
Time:        4.972 s
Ran all test suites.
